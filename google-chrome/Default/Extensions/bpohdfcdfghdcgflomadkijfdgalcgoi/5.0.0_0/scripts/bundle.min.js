/*
 Copyright 2016-2017 Next Thing Co. All Rights Reserved
*/
var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(l,h,f){if(f.get||f.set)throw new TypeError("ES3 does not support getters and setters.");l!=Array.prototype&&l!=Object.prototype&&(l[h]=f.value)};$jscomp.getGlobal=function(l){return"undefined"!=typeof window&&window===l?l:"undefined"!=typeof global&&null!=global?global:l};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(l){return $jscomp.SYMBOL_PREFIX+(l||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var l=$jscomp.global.Symbol.iterator;l||(l=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[l]&&$jscomp.defineProperty(Array.prototype,l,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(l){var h=0;return $jscomp.iteratorPrototype(function(){return h<l.length?{done:!1,value:l[h++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(l){$jscomp.initSymbolIterator();l={next:l};l[$jscomp.global.Symbol.iterator]=function(){return this};return l};$jscomp.makeIterator=function(l){$jscomp.initSymbolIterator();var h=l[Symbol.iterator];return h?h.call(l):$jscomp.arrayIterator(l)};
$jscomp.polyfill=function(l,h,f,g){if(h){f=$jscomp.global;l=l.split(".");for(g=0;g<l.length-1;g++){var m=l[g];m in f||(f[m]={});f=f[m]}l=l[l.length-1];g=f[l];h=h(g);h!=g&&null!=h&&$jscomp.defineProperty(f,l,{configurable:!0,writable:!0,value:h})}};$jscomp.EXPOSE_ASYNC_EXECUTOR=!0;$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(l){function h(){this.batch_=null}if(l&&!$jscomp.FORCE_POLYFILL_PROMISE)return l;h.prototype.asyncExecute=function(c){null==this.batch_&&(this.batch_=[],this.asyncExecuteBatch_());this.batch_.push(c);return this};h.prototype.asyncExecuteBatch_=function(){var c=this;this.asyncExecuteFunction(function(){c.executeBatch_()})};var f=$jscomp.global.setTimeout;h.prototype.asyncExecuteFunction=function(c){f(c,0)};h.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var c=
this.batch_;this.batch_=[];for(var a=0;a<c.length;++a){var e=c[a];delete c[a];try{e()}catch(d){this.asyncThrow_(d)}}}this.batch_=null};h.prototype.asyncThrow_=function(c){this.asyncExecuteFunction(function(){throw c;})};var g=function(c){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var a=this.createResolveAndReject_();try{c(a.resolve,a.reject)}catch(e){a.reject(e)}};g.prototype.createResolveAndReject_=function(){function c(d){return function(b){e||(e=!0,d.call(a,b))}}var a=this,e=
!1;return{resolve:c(this.resolveTo_),reject:c(this.reject_)}};g.prototype.resolveTo_=function(c){if(c===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(c instanceof g)this.settleSameAsPromise_(c);else{var a;a:switch(typeof c){case "object":a=null!=c;break a;case "function":a=!0;break a;default:a=!1}a?this.resolveToNonPromiseObj_(c):this.fulfill_(c)}};g.prototype.resolveToNonPromiseObj_=function(c){var a=void 0;try{a=c.then}catch(e){this.reject_(e);return}"function"==
typeof a?this.settleSameAsThenable_(a,c):this.fulfill_(c)};g.prototype.reject_=function(c){this.settle_(2,c)};g.prototype.fulfill_=function(c){this.settle_(1,c)};g.prototype.settle_=function(c,a){if(0!=this.state_)throw Error("Cannot settle("+c+", "+a|"): Promise already settled in state"+this.state_);this.state_=c;this.result_=a;this.executeOnSettledCallbacks_()};g.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var c=this.onSettledCallbacks_,a=0;a<c.length;++a)c[a].call(),
c[a]=null;this.onSettledCallbacks_=null}};var m=new h;g.prototype.settleSameAsPromise_=function(c){var a=this.createResolveAndReject_();c.callWhenSettled_(a.resolve,a.reject)};g.prototype.settleSameAsThenable_=function(c,a){var e=this.createResolveAndReject_();try{c.call(a,e.resolve,e.reject)}catch(d){e.reject(d)}};g.prototype.then=function(c,a){function e(a,k){return"function"==typeof a?function(k){try{d(a(k))}catch(x){b(x)}}:k}var d,b,k=new g(function(a,k){d=a;b=k});this.callWhenSettled_(e(c,d),
e(a,b));return k};g.prototype["catch"]=function(c){return this.then(void 0,c)};g.prototype.callWhenSettled_=function(c,a){function e(){switch(d.state_){case 1:c(d.result_);break;case 2:a(d.result_);break;default:throw Error("Unexpected state: "+d.state_);}}var d=this;null==this.onSettledCallbacks_?m.asyncExecute(e):this.onSettledCallbacks_.push(function(){m.asyncExecute(e)})};g.resolve=function(c){return c instanceof g?c:new g(function(a,e){a(c)})};g.reject=function(c){return new g(function(a,e){e(c)})};
g.race=function(c){return new g(function(a,e){for(var d=$jscomp.makeIterator(c),b=d.next();!b.done;b=d.next())g.resolve(b.value).callWhenSettled_(a,e)})};g.all=function(c){var a=$jscomp.makeIterator(c),e=a.next();return e.done?g.resolve([]):new g(function(d,b){function k(b){return function(a){p[b]=a;c--;0==c&&d(p)}}var p=[],c=0;do p.push(void 0),c++,g.resolve(e.value).callWhenSettled_(k(p.length-1),b),e=a.next();while(!e.done)})};$jscomp.EXPOSE_ASYNC_EXECUTOR&&(g.$jscomp$new$AsyncExecutor=function(){return new h});
return g},"es6-impl","es3");$jscomp.polyfill("Array.from",function(l){return l?l:function(h,f,g){$jscomp.initSymbolIterator();f=null!=f?f:function(a){return a};var m=[],c=h[Symbol.iterator];if("function"==typeof c)for(h=c.call(h);!(c=h.next()).done;)m.push(f.call(g,c.value));else for(var c=h.length,a=0;a<c;a++)m.push(f.call(g,h[a]));return m}},"es6-impl","es3");
$jscomp.checkStringArgs=function(l,h,f){if(null==l)throw new TypeError("The 'this' value for String.prototype."+f+" must not be null or undefined");if(h instanceof RegExp)throw new TypeError("First argument to String.prototype."+f+" must not be a regular expression");return l+""};
$jscomp.polyfill("String.prototype.startsWith",function(l){return l?l:function(h,f){var g=$jscomp.checkStringArgs(this,h,"startsWith");h+="";for(var m=g.length,c=h.length,a=Math.max(0,Math.min(f|0,g.length)),e=0;e<c&&a<m;)if(g[a++]!=h[e++])return!1;return e>=c}},"es6-impl","es3");$jscomp.polyfill("Object.setPrototypeOf",function(l){return l?l:"object"!=typeof"".__proto__?null:function(h,f){h.__proto__=f;if(h.__proto__!==f)throw new TypeError(h+" is not extensible");return h}},"es6","es5");
$jscomp.owns=function(l,h){return Object.prototype.hasOwnProperty.call(l,h)};
$jscomp.polyfill("WeakMap",function(l){function h(a){$jscomp.owns(a,g)||$jscomp.defineProperty(a,g,{value:{}})}function f(a){var e=Object[a];e&&(Object[a]=function(d){h(d);return e(d)})}if(function(){if(!l||!Object.seal)return!1;try{var a=Object.seal({}),e=Object.seal({}),d=new l([[a,2],[e,3]]);if(2!=d.get(a)||3!=d.get(e))return!1;d["delete"](a);d.set(e,4);return!d.has(a)&&4==d.get(e)}catch(b){return!1}}())return l;var g="$jscomp_hidden_"+Math.random().toString().substring(2);f("freeze");f("preventExtensions");
f("seal");var m=0,c=function(a){this.id_=(m+=Math.random()+1).toString();if(a){$jscomp.initSymbol();$jscomp.initSymbolIterator();a=$jscomp.makeIterator(a);for(var e;!(e=a.next()).done;)e=e.value,this.set(e[0],e[1])}};c.prototype.set=function(a,e){h(a);if(!$jscomp.owns(a,g))throw Error("WeakMap key fail: "+a);a[g][this.id_]=e;return this};c.prototype.get=function(a){return $jscomp.owns(a,g)?a[g][this.id_]:void 0};c.prototype.has=function(a){return $jscomp.owns(a,g)&&$jscomp.owns(a[g],this.id_)};c.prototype["delete"]=
function(a){return $jscomp.owns(a,g)&&$jscomp.owns(a[g],this.id_)?delete a[g][this.id_]:!1};return c},"es6-impl","es3");$jscomp.ASSUME_NO_NATIVE_MAP=!1;
$jscomp.polyfill("Map",function(l){if(!$jscomp.ASSUME_NO_NATIVE_MAP&&function(){if(!l||!l.prototype.entries||"function"!=typeof Object.seal)return!1;try{var a=Object.seal({x:4}),d=new l($jscomp.makeIterator([[a,"s"]]));if("s"!=d.get(a)||1!=d.size||d.get({x:4})||d.set({x:4},"t")!=d||2!=d.size)return!1;var b=d.entries(),k=b.next();if(k.done||k.value[0]!=a||"s"!=k.value[1])return!1;k=b.next();return k.done||4!=k.value[0].x||"t"!=k.value[1]||!b.next().done?!1:!0}catch(p){return!1}}())return l;$jscomp.initSymbol();
$jscomp.initSymbolIterator();var h=new WeakMap,f=function(a){this.data_={};this.head_=c();this.size=0;if(a){a=$jscomp.makeIterator(a);for(var d;!(d=a.next()).done;)d=d.value,this.set(d[0],d[1])}};f.prototype.set=function(a,d){var b=g(this,a);b.list||(b.list=this.data_[b.id]=[]);b.entry?b.entry.value=d:(b.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:a,value:d},b.list.push(b.entry),this.head_.previous.next=b.entry,this.head_.previous=b.entry,this.size++);return this};f.prototype["delete"]=
function(a){a=g(this,a);return a.entry&&a.list?(a.list.splice(a.index,1),a.list.length||delete this.data_[a.id],a.entry.previous.next=a.entry.next,a.entry.next.previous=a.entry.previous,a.entry.head=null,this.size--,!0):!1};f.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=c();this.size=0};f.prototype.has=function(a){return!!g(this,a).entry};f.prototype.get=function(a){return(a=g(this,a).entry)&&a.value};f.prototype.entries=function(){return m(this,function(a){return[a.key,
a.value]})};f.prototype.keys=function(){return m(this,function(a){return a.key})};f.prototype.values=function(){return m(this,function(a){return a.value})};f.prototype.forEach=function(a,d){for(var b=this.entries(),k;!(k=b.next()).done;)k=k.value,a.call(d,k[1],k[0],this)};f.prototype[Symbol.iterator]=f.prototype.entries;var g=function(c,d){var b;b=d&&typeof d;"object"==b||"function"==b?h.has(d)?b=h.get(d):(b=""+ ++a,h.set(d,b)):b="p_"+d;var k=c.data_[b];if(k&&$jscomp.owns(c.data_,b))for(var p=0;p<
k.length;p++){var e=k[p];if(d!==d&&e.key!==e.key||d===e.key)return{id:b,list:k,index:p,entry:e}}return{id:b,list:k,index:-1,entry:void 0}},m=function(a,d){var b=a.head_;return $jscomp.iteratorPrototype(function(){if(b){for(;b.head!=a.head_;)b=b.previous;for(;b.next!=b.head;)return b=b.next,{done:!1,value:d(b)};b=null}return{done:!0,value:void 0}})},c=function(){var a={};return a.previous=a.next=a.head=a},a=0;return f},"es6-impl","es3");$jscomp.ASSUME_NO_NATIVE_SET=!1;
$jscomp.polyfill("Set",function(l){if(!$jscomp.ASSUME_NO_NATIVE_SET&&function(){if(!l||!l.prototype.entries||"function"!=typeof Object.seal)return!1;try{var f=Object.seal({x:4}),g=new l($jscomp.makeIterator([f]));if(!g.has(f)||1!=g.size||g.add(f)!=g||1!=g.size||g.add({x:4})!=g||2!=g.size)return!1;var m=g.entries(),c=m.next();if(c.done||c.value[0]!=f||c.value[1]!=f)return!1;c=m.next();return c.done||c.value[0]==f||4!=c.value[0].x||c.value[1]!=c.value[0]?!1:m.next().done}catch(a){return!1}}())return l;
$jscomp.initSymbol();$jscomp.initSymbolIterator();var h=function(f){this.map_=new Map;if(f){f=$jscomp.makeIterator(f);for(var g;!(g=f.next()).done;)this.add(g.value)}this.size=this.map_.size};h.prototype.add=function(f){this.map_.set(f,f);this.size=this.map_.size;return this};h.prototype["delete"]=function(f){f=this.map_["delete"](f);this.size=this.map_.size;return f};h.prototype.clear=function(){this.map_.clear();this.size=0};h.prototype.has=function(f){return this.map_.has(f)};h.prototype.entries=
function(){return this.map_.entries()};h.prototype.values=function(){return this.map_.values()};h.prototype[Symbol.iterator]=h.prototype.values;h.prototype.forEach=function(f,g){var m=this;this.map_.forEach(function(c){return f.call(g,c,c,m)})};return h},"es6-impl","es3");$jscomp.polyfill("String.prototype.includes",function(l){return l?l:function(h,f){return-1!==$jscomp.checkStringArgs(this,h,"includes").indexOf(h,f||0)}},"es6-impl","es3");
$jscomp.polyfill("String.prototype.endsWith",function(l){return l?l:function(h,f){var g=$jscomp.checkStringArgs(this,h,"endsWith");h+="";void 0===f&&(f=g.length);for(var m=Math.max(0,Math.min(f|0,g.length)),c=h.length;0<c&&0<m;)if(g[--m]!=h[--c])return!1;return 0>=c}},"es6-impl","es3");
$jscomp.polyfill("Array.prototype.fill",function(l){return l?l:function(h,f,g){var m=this.length||0;0>f&&(f=Math.max(0,m+f));if(null==g||g>m)g=m;g=Number(g);0>g&&(g=Math.max(0,m+g));for(f=Number(f||0);f<g;f++)this[f]=h;return this}},"es6-impl","es3");
(function(l){function h(g){if(f[g])return f[g].exports;var m=f[g]={i:g,l:!1,exports:{}};l[g].call(m.exports,m,m.exports,h);m.l=!0;return m.exports}var f={};h.m=l;h.c=f;h.i=function(g){return g};h.d=function(g,f,c){h.o(g,f)||Object.defineProperty(g,f,{configurable:!1,enumerable:!0,get:c})};h.n=function(g){var f=g&&g.__esModule?function(){return g["default"]}:function(){return g};h.d(f,"a",f);return f};h.o=function(g,f){return Object.prototype.hasOwnProperty.call(g,f)};h.p="";return h(h.s=30)})([function(l,
h,f){var g=!1,m=!0,c=!1,a=!0;l.exports={trackPrefix:"",development:!1,debug:function(a){g&&console.log(a)},error:function(a){m&&console.log(a)},info:function(a){c&&console.log(a)},trace:function(a){},meta:function(c){a&&console.log(c)},trackFunc:null,track:function(a,d){this.trackFunc&&!this.development&&this.trackFunc(a,d)},analyticsFunc:null,analytics:function(a){this.analyticsFunc&&!this.development&&this.analyticsFunc(a)},setLevel:function(e){e&&(e=e.toUpperCase(),"DEBUG"===e?a=c=m=g=!0:"INFO"===
e&&(g=!1,a=c=m=!0))}}},function(l,h,f){function g(a,b){var d=String.fromCharCode.apply(null,a);b&&(d=d.replace(/\n/g," "));return d}function m(a,b){var d=Number(a).toString(16);for(b="undefined"===typeof b||null===b?b=8:b;d.length<b;)d="0"+d;return d}function c(a,b){var d=this;b=b||!1;return fetch(a,{mode:"cors"}).then(function(b){return b.arrayBuffer()}).then(function(a){return b?d.unLzma(a):a})}function a(a){var b=new FileReader;return new Promise(function(d){b.onloadend=function(b){return d(b.target.result)};
b.readAsArrayBuffer(a)})}var e=f(0);String.prototype.format||(String.prototype.format=function(){var a=arguments;return this.replace(/{(\d+)}/g,function(b,d){return"undefined"!=typeof a[d]?a[d]:b})});l.exports={arrToString:g,bufferToString:function(a){return g(new Uint8Array(a))},copyStringIntoArrayBuffer:function(a,b,k){k=k||0;b=new Uint8Array(b);for(var d=0;d<a.length;d++)b[d+k]=a.charCodeAt(d)},arrayBufferEquals:function(a,b,k){var d=a.byteLength;if(k){if(b.byteLength<d)return!1}else if(a.byteLength!==
b.byteLength)return!1;for(k=0;k<d;k++)if(a[k]!==b[k])return!1;return!0},appendBuffer:function(a,b){var d=new Uint8Array(a.byteLength+b.byteLength);d.set(a,0);d.set(b,a.byteLength);return d},pollPromise:function(a,b,k){function d(){return c?Promise.resolve(!1):a()["catch"](function(b){e.info("Error when polling. likely benign"+b);return!1}).then(function(a){return a?Promise.resolve(a):Promise.delay(b).then(d)})}var c=!1;return d().timeout(k)["catch"](Promise.TimeoutError,function(b){c=!0;throw b;})},
stringToArr:function(a){for(var b=new ArrayBuffer(a.length),b=new Uint8Array(b),d=0;d<a.length;d++)b[d]=a.charCodeAt(d);return b},arrToStringConvertNonAscii:function(a,b){b=b||999999;for(var d="",p=0;p<a.byteLength;p++){var c=a[p],d=32>c||127<c?d+".":d+String.fromCharCode(c);if(p>=b){d+="---LONG";break}}return d},magicToVidPid:function(a){return[a>>16,a&65535]},listSerialNumbers:function(a){var b=[],d=!0,p=!1,c=void 0;try{for(var e=a[Symbol.iterator](),g;!(d=(g=e.next()).done);d=!0){var f=g.value;
f.serialNumber&&b.push(f.serialNumber)}}catch(C){p=!0,c=C}finally{try{!d&&e["return"]&&e["return"]()}finally{if(p)throw c;}}return b},subArrayToString:function(a,b,k){return g(new Uint8Array(a.slice(b,k)))},toHex:m,letoh32:function(a){return(new DataView(a.buffer)).getUint32(0,!0)},enqueueOnly:!1,fetchUrlIntoArrayBuffer:c,readUrlOrFile:function(d,b){return d?c(d):a(b)},readFile:a,stringifyError:function(a,b,k){b=b||null;k=k||" ";var d={};Object.getOwnPropertyNames(a).forEach(function(b){d[b]=a[b]});
return JSON.stringify(d,b,k)},unLzma:function(a){return new Promise(function(b){var d=Array.from(new Uint8Array(a)),d=LZMA.decompress(d),d=Uint8Array.from(d);b(d)})},MAX_CHIPS:3,dumpBuffer:function(a,b){b=b||256;for(var d=new Uint8Array(a),c="",e=0,g=0;g<a.byteLength;g++)c+=m(d[g],2)+" ",0===(g+1)%b&&(console.log(m(e,3)+": "+c),c="",e++);console.log(m(e,3)+": "+c)},msToHhMmSs:function(a){var b=new Date(null);b.setSeconds(a/1E3);return b.toISOString().substr(11,8)},clone:function(a){return JSON.parse(JSON.stringify(a))},
LITTLE_ENDIAN:!0}},function(l,h,f){var g=function(){function g(c,a){for(var e=0;e<a.length;e++){var d=a[e];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(c,d.key,d)}}return function(c,a,e){a&&g(c.prototype,a);e&&g(c,e);return c}}();h=function(){function f(){if(!(this instanceof f))throw new TypeError("Cannot call a class as a function");this.init();this.cleanUp()}g(f,[{key:"init",value:function(){this.bytes=this.totalBytes=this.currentPercent=0;
this.lastActiveStage=this.lastKnownStage=this.start=null;this.paused=!1}},{key:"getCurrentPercent",value:function(){return this.currentPercent}},{key:"getLastActiveStage",value:function(){return this.lastActiveStage}},{key:"cleanUp",value:function(){this.progressObservers=[];this.deviceObservers=[];this.stateObservers=[];this.dataObservers=[];this.errorObservers=[]}},{key:"pause",value:function(){this.paused=!0}},{key:"resume",value:function(){this.paused=!1}},{key:"addProgressObserver",value:function(c){this.progressObservers.push(c)}},
{key:"addDeviceObserver",value:function(c){this.deviceObservers.push(c)}},{key:"addStateObserver",value:function(c){this.stateObservers.push(c)}},{key:"addErrorObserver",value:function(c){this.errorObservers.push(c)}},{key:"addDataObserver",value:function(c){this.dataObservers.push(c)}},{key:"setTotalBytes",value:function(c){this.totalBytes=c}},{key:"addBytes",value:function(c,a){if(!this.paused){var e=!this.start;this.start||(this.start=(new Date).getTime());this.bytes+=c;var d=Math.floor(100*this.bytes/
this.totalBytes);100===d&&0!==a&&(d=99);if(e||d!==this.currentPercent)this.currentPercent=d,this.notifyProgress()}}},{key:"forceComplete",value:function(){this.bytes=this.totalBytes;this.currentPercent=100;this.notifyStage(f.DONE,f.PASS_STATE)}},{key:"getElapsedTime",value:function(){return(new Date).getTime()-this.start}},{key:"notifyProgress",value:function(){if(!this.paused){var c=this.getElapsedTime(),c={bytes:this.bytes,totalBytes:this.totalBytes,percent:this.currentPercent||0,elapsedTime:c,
estimatedTimeRemaining:c*this.totalBytes/(this.bytes||1)-c,stage:this.lastKnownStage},a=!0,e=!1,d=void 0;try{for(var b=this.progressObservers[Symbol.iterator](),k;!(a=(k=b.next()).done);a=!0){var p=k.value;p(c)}}catch(t){e=!0,d=t}finally{try{!a&&b["return"]&&b["return"]()}finally{if(e)throw d;}}}}},{key:"notifyDeviceCount",value:function(c,a,e){if(!this.paused){var d={count:c,serialNumberArray:a,added:c>e,removed:c<e};1===c&&(d.serialNumber=a[0]);a=!0;var b=!1,k=void 0;try{for(var p=this.deviceObservers[Symbol.iterator](),
t;!(a=(t=p.next()).done);a=!0){var g=t.value;g(d)}}catch(x){b=!0,k=x}finally{try{!a&&p["return"]&&p["return"]()}finally{if(b)throw k;}}0!==c&&0===e&&this.notifyState({state:f.PASSIVE_STATE,stage:f.WAITING})}}},{key:"notifyStage",value:function(c,a,e){var d={stage:c};a&&(d.state=a);this.lastKnownStage=c;c!==f.DONE&&(this.lastActiveStage=c);this.notifyState(d,e||!1)}},{key:"notifyState",value:function(c,a){if(a||!this.paused){var e=!0,d=!1,b=void 0;try{for(var k=this.stateObservers[Symbol.iterator](),
p;!(e=(p=k.next()).done);e=!0){var t=p.value;t(c)}}catch(u){d=!0,b=u}finally{try{!e&&k["return"]&&k["return"]()}finally{if(d)throw b;}}}}},{key:"notifyData",value:function(c){var a=!0,e=!1,d=void 0;try{for(var b=this.dataObservers[Symbol.iterator](),k;!(a=(k=b.next()).done);a=!0){var p=k.value;p(c)}}catch(t){e=!0,d=t}finally{try{!a&&b["return"]&&b["return"]()}finally{if(e)throw d;}}}},{key:"notifyError",value:function(c){var a=!0,e=!1,d=void 0;try{for(var b=this.errorObservers[Symbol.iterator](),
k;!(a=(k=b.next()).done);a=!0){var p=k.value;p(c)}}catch(t){e=!0,d=t}finally{try{!a&&b["return"]&&b["return"]()}finally{if(e)throw d;}}}}]);return f}();h.DISCONNECTED_STATE=-1;h.PASSIVE_STATE=0;h.ACTIVE_STATE=1;h.PAUSED_STATE=2;h.PROMPT_STATE=3;h.PASS_STATE=4;h.FAIL_STATE=5;h.IDLE_STATE=6;h.DONE="Done";h.WAITING="Waiting";h.WAITING_FOR_FEL="Waiting for FEL";h.FEL="Processing FEL";h.WAITING_FOR_FASTBOOT="Waiting for Fastboot";h.FASTBOOT="Processing Fastboot";h.READING_DEVICE_INFO="Reading device information";
h.INITIALIZING="Initializing";h.READ_VERSION="Ready";h.NEED_TO_UPDATE_APP="You need to update the App. Go to chrome://extensions and click 'Update extensions now'";h.CHECKING_FASTBOOT_CONNECTIVITY="Trying to communicate using fastboot";h.SENDING_UBOOT_COMMAND="Sending a command over u-boot";l.exports=h},function(l,h,f){var g=function(){function c(a,c){for(var d=0;d<c.length;d++){var b=c[d];b.enumerable=b.enumerable||!1;b.configurable=!0;"value"in b&&(b.writable=!0);Object.defineProperty(a,b.key,b)}}
return function(a,e,d){e&&c(a.prototype,e);d&&c(a,d);return a}}(),m=f(0);h=function(){function c(a,e){if(!(this instanceof c))throw new TypeError("Cannot call a class as a function");this.dataProcessor=a;this.dataProcessor.setStreamHandler(this);this.enqueuedByteLimit=e||Number.MAX_VALUE;this.paused=!1;this.enqueuedBytes=0;this.startTime=(new Date).getTime()}g(c,[{key:"doFetch",value:function(a){throw"virtual, must implement";}},{key:"addBytes",value:function(a){this.enqueuedBytes+=a;0<a&&this.enqueuedBytes>=
this.enqueuedByteLimit&&this.highWaterMark(!0);0>a&&this.enqueuedBytes<this.enqueuedByteLimit&&this.highWaterMark(!1)}},{key:"highWaterMark",value:function(a){this.defaultHighWaterMark(a)}},{key:"defaultHighWaterMark",value:function(a){this.pausable&&(m.debug("Highwater="+a),a?this.paused||(this.paused=!0,m.debug("Pausing read----------------------")):this.paused&&(this.paused=!1,m.debug("Resuming read-------------------------"),this.read()))}}]);return c}();l.exports=h},function(l,h,f){function g(b,
a,d){a in b?Object.defineProperty(b,a,{value:d,enumerable:!0,configurable:!0,writable:!0}):b[a]=d;return b}function m(b,a){d.info("Erasing "+b+" in fastboot");return a.write("erase:"+b).then(function(){return a.read("OKAY",!1)}).then(function(a){if(!a)throw Error("erase:"+b+" not OKAY");return a})}function c(b,d){return Promise.mapSeries(b,function(b){return a(b,d)}).then(function(a){for(var d={},k=0;k<b.length;k++)d[k]=a[k];return d})}function a(b,a){d.info("getvar "+b);return a.write("getvar:"+
b).then(function(b){return a.readBytes(64).then(function(b){return b&&b.startsWith("OKAY")?b.substring(4):null})})}var e,d=f(0),b=f(1),k=b.stringToArr("continue");b.stringToArr("OKAY");l.exports=(e={eraseUBI:function(b){return m("UBI",b)},erasePartition:m,getFastbootVar:a,isContinue:function(a){return b.arrayBufferEquals(k,a,!0)},getFastbootVariables:c},g(e,"getFastbootVar",a),g(e,"getFastbootNandVariables",function(b){return c(["nand_oobsize","nand_erasesize","nand_writesize"],b)}),g(e,"parseEnvironment",
function(a){a=b.bufferToString(a).split("\n");var d={},k=!0,c=!1,e=void 0;try{for(var p=a[Symbol.iterator](),g;!(k=(g=p.next()).done);k=!0){var f=g.value,h=f.indexOf("=");if(-1===h)break;d[f.substring(0,h)]=f.substring(h+1)}}catch(v){c=!0,e=v}finally{try{!k&&p["return"]&&p["return"]()}finally{if(c)throw e;}}return d}),g(e,"fastbootContinue",function(b){return b.write("continue").then(function(a){return b.readBytes(64)}).then(function(b){return b&&b.startsWith("OKAY")?b.substring(4):null})}),e)},function(l,
h,f){function g(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}var m=function(){function a(b,a){for(var d=0;d<a.length;d++){var k=a[d];k.enumerable=k.enumerable||!1;k.configurable=!0;"value"in k&&(k.writable=!0);Object.defineProperty(b,k.key,k)}}return function(b,d,c){d&&a(b.prototype,d);c&&a(b,c);return b}}(),c=f(0),a=f(1),e=function(){function a(b){g(this,a);this.init();this.device=b;this.serialNumber=b.serialNumber}m(a,[{key:"init",value:function(){this.outEp=
this.inEp=this.handle=null;this.state=this.writeIndex=0}},{key:"magicNumber",value:function(){return(this.vid<<16)+this.pid}}]);return a}();h=function(){function d(b){g(this,d);this.deviceHandler=b;this.forceWaitForState=!1;this.initialize()}m(d,[{key:"resetChips",value:function(){return 1===this.chips.length?this.deviceHandler.resetPromise(this.chips[0]):Promise.resolve()}},{key:"initialize",value:function(){this.chips=[];this.errorState=null}},{key:"waitForFastboot",value:function(){return this.waitForStatePromise(7994,
4112).then(function(){c.info("Fastboot found")})}},{key:"waitForFELWithoutOpening",value:function(b,d,c,e){var k=this;b=b||7994;d=d||61416;c=c||1;return a.pollPromise(function(){return k.deviceHandler.getDevicesPromise(b,d).then(function(b){b&&b.length===c&&console.log("Found FEL");return b}).bind(k)},1E3,2E4)}},{key:"waitForStatePromise",value:function(b,d,e,g,f){var k=this;b=b||7994;d=d||61416;e=e||1;g=g||2E4;var p=this;return Promise.resolve().then(function(){k.forceWaitForState&&(k.initialize(),
k.forceWaitForState=!1);if(p.chips&&0<p.chips.length){for(var t=0,f=0;f<e;f++)b===p.chips[f].vid&&d===p.chips[f].pid&&t++;if(t===e)return!0}var h=function(){return p.openAllPromise(b,d,e).then(function(b){return b&&b.length===e})}.bind(p);return p.closeAllExcept(b,d).then(function(){return a.pollPromise(h,1E3,g)}).then(function(a){c.debug("Just polled for device "+b.toString(16)+":"+d.toString(16));return a})})}},{key:"openAllPromise",value:function(b,a,d){var k=this;return this.deviceHandler.getDevicesPromise(b,
a).then(function(c){return k.openAllDevices(c,d,b,a)})}},{key:"openAllDevices",value:function(b,d,p,g){var k=this;d=d||1;p=p||7994;g=g||61416;var f=this;this.chips=[];return Promise.resolve(b).then(function(b){if(b.length<d)return null;b=b.slice(0,d);return Promise.delay(1E3*d).then(function(){return Promise.map(b,function(b){b=new e(b);f.chips.push(b);b.vid=p;b.pid=g;return f.deviceHandler.openChipPromise(b)})})}).then(function(b){if(k.chips=b){var d=!0,e=!1,p=void 0;try{for(var g=b[Symbol.iterator](),
t;!(d=(t=g.next()).done);d=!0)if(!t.value)return k.initialize(),null}catch(A){e=!0,p=A}finally{try{!d&&g["return"]&&g["return"]()}finally{if(e)throw p;}}f.serialNumbers=a.listSerialNumbers(b)}c.info("opened "+(b?b.length:0)+" chips");return b})}},{key:"closeAllExcept",value:function(b,a){var d=this;b=b||0;a=a||0;var k=[],e=[];if(this.chips){var g=!0,f=!1,h=void 0;try{for(var m=this.chips[Symbol.iterator](),l;!(g=(l=m.next()).done);g=!0){var q=l.value;q.vid!==b||q.pid!==a?k.push(this.deviceHandler.closePromise(q)):
e.push(q)}}catch(v){f=!0,h=v}finally{try{!g&&m["return"]&&m["return"]()}finally{if(f)throw h;}}}k=Promise.all(k).then(function(){d.chips=e;c.info("just closed all CHIPs. new count is "+d.chips.length)});k.dbg="closeAllExcept "+b.toString(16)+":"+a.toString(16);return k}},{key:"writePromise",value:function(b,a){a=a||0;var d=this.deviceHandler.writePromise(this.chips[0],b);d.dbg="writePromise "+a;return d}},{key:"readPromise",value:function(b,d,e){var k=this;d=d||0;var p=this.deviceHandler.readPromise(this.chips[0],
b);p.then(function(p){if(a.arrayBufferEquals(p,b,!0))return p;if(e)return b;c.error("BAD READ index "+d+"failed to read back correctly");c.error("read: "+a.arrToString(p)+" expecting "+a.arrToString(b));k.errorState=Error("bad read back "+d);throw k.errorState;})["catch"](function(a){if(e||"Device disconnected."===a.message)return b;throw a;});p.dbg="readPromise "+d;return p}},{key:"write",value:function(b){return this.writePromise(a.stringToArr(b))}},{key:"read",value:function(b,d){void 0===d&&(d=
!0);"string"===typeof b&&(b=a.stringToArr(b));return this.readPromise(b,0,!d).then(function(k){return d?a.arrayBufferEquals(b,k,!0):a.arrToString(k)})}},{key:"readBytes",value:function(b){return this.read(new Uint8Array(b),!1)}},{key:"getDeviceCount",value:function(b){b=a.magicToVidPid(b);return this.deviceHandler.getDevicesPromise(b[0],b[1]).then(function(b){return b.length})}},{key:"getDeviceCount2",value:function(b,a){var d=this;return this.getDeviceCount(b).then(function(b){return b?b:d.getDeviceCount(a)})}}]);
return d}();l.exports=h},function(l,h,f){var g=function(){function g(c,a){for(var e=0;e<a.length;e++){var d=a[e];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(c,d.key,d)}}return function(c,a,e){a&&g(c.prototype,a);e&&g(c,e);return c}}();h=function(){function f(){if(!(this instanceof f))throw new TypeError("Cannot call a class as a function");}g(f,[{key:"getDevicesPromise",value:function(c,a){throw"not implemented";}},{key:"openChipPromise",value:function(c){throw"not implemented";
}},{key:"writePromise",value:function(c,a){throw"not implemented";}},{key:"readPromise",value:function(c,a){throw"not implemented";}},{key:"closePromise",value:function(c){throw"not implemented";}},{key:"resetPromise",value:function(c){throw"not implemented";}}]);return f}();l.exports=h},function(l,h,f){function g(a,c){if("function"!==typeof c&&null!==c)throw new TypeError("Super expression must either be null or a function, not "+typeof c);a.prototype=Object.create(c&&c.prototype,{constructor:{value:a,
enumerable:!1,writable:!0,configurable:!0}});c&&(Object.setPrototypeOf?Object.setPrototypeOf(a,c):a.__proto__=c)}var m=function(){function a(a,d){for(var b=0;b<d.length;b++){var k=d[b];k.enumerable=k.enumerable||!1;k.configurable=!0;"value"in k&&(k.writable=!0);Object.defineProperty(a,k.key,k)}}return function(c,d,b){d&&a(c.prototype,d);b&&a(c,b);return c}}();h=f(3);var c=f(0);f(1);f=function(a){function e(a,b){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");var d;
d=(e.__proto__||Object.getPrototypeOf(e)).call(this,a,b);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");d=!d||"object"!==typeof d&&"function"!==typeof d?this:d;d.pausable=!1;d.offset=0;d.chunkSize=32768;d.file=null;d.fileReader=new FileReader;d.fileReader.onload=d.onLoad.bind(d);d.resolve=null;d.done=!1;return d}g(e,a);m(e,[{key:"onLoad",value:function(a){var b=this.dataProcessor;b.isDone()?this.done=!0:(b.reject=this.reject,a.target.error?b.handleError(a.target.error):
(this.offset+=a.target.result.byteLength,b.processChunk(new Uint8Array(a.target.result)),this.offset>=this.fileSize?(b.spark&&c.meta("Hash code is"+b.calcHash()),b.addCleanUpMeta(this.startTime),b.addMeta(this.resolve)):this.pausable&&this.paused||this.read()))}},{key:"read",value:function(){if(!this.done){var a=this.file.slice(this.offset,this.chunkSize+this.offset);return this.fileReader.readAsArrayBuffer(a)}}},{key:"doFetch",value:function(a){var b=this;return new Promise(function(d,c){b.resolve=
d;b.reject=c;b.file=a;b.fileSize=a.size;return b.read()})}}]);return e}(h);l.exports=f},function(l,h,f){l.exports={MAX_CHIPS:1}},function(l,h,f){var g=function(){function a(a,b){for(var d=0;d<b.length;d++){var c=b[d];c.enumerable=c.enumerable||!1;c.configurable=!0;"value"in c&&(c.writable=!0);Object.defineProperty(a,c.key,c)}}return function(d,b,c){b&&a(d.prototype,b);c&&a(d,c);return d}}(),m=f(1);h="echo Reading Environment Information\nsetenv bootdelay 1\nnand info\nenv export -t -s "+(512).toString(16)+
" "+(31744).toString(16)+" nand_erasesize nand_writesize nand_oobsize serial# ethaddr usbnet_devaddr customName\nsaveenv\nmw ${scriptaddr} 0x0\nreset";var c={"default":!0,name:"H27QCG8T2E5R\u2010BCF 64G 3.3V 8-bit",displayName:"Hynix 8G MLC",id:"Hynix_8G_MLC",nand_erasesize:4194304,nand_oobsize:1664,nand_writesize:16384,capacity:8589934592},a=[c,{name:"toshiba 32G 8-bit",displayName:"Toshiba 4G MLC",id:"Toshiba_4G_MLC",nand_erasesize:4194304,nand_oobsize:1280,nand_writesize:16384,capacity:4294967296},
{name:"TC58NVG2SS0HT 4G 3.3V 8-bit",displayName:"Toshiba 512M SLC",id:"Toshiba_512M_SLC",nand_erasesize:262144,nand_oobsize:256,nand_writesize:4096,capacity:536870912}];f=function(){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");}g(e,null,[{key:"findNand",value:function(d,b,c){var k=!0,e=!1,g=void 0;try{for(var f=a[Symbol.iterator](),h;!(k=(h=f.next()).done);k=!0){var m=h.value;if(m.nand_erasesize===d&&m.nand_oobsize===b&&m.nand_writesize===c)return m}}catch(z){e=
!0,g=z}finally{try{!k&&f["return"]&&f["return"]()}finally{if(e)throw g;}}console.log("nand_erasesize, nand_oobsize, nand_writesize",d.toString(16),b.toString(16),c.toString(16));throw Error("NAND not found: erasesize="+d+" oobsize="+b+" writesize="+c);}},{key:"findNandById",value:function(d){var b=!0,c=!1,e=void 0;try{for(var g=a[Symbol.iterator](),f;!(b=(f=g.next()).done);b=!0){var h=f.value;if(h.id===d)return h}}catch(w){c=!0,e=w}finally{try{!b&&g["return"]&&g["return"]()}finally{if(c)throw e;}}throw Error("user-specified NAND not found "+
d);}},{key:"makeFakeEnvironment",value:function(a){var b={};b.nandChip=e.findNandById(a);b.defaultNandChip=c;b["serial#"]=null;return b}},{key:"parseEnvironment",value:function(a){a=m.bufferToString(a).split("\n");var b={},d=!0,p=!1,g=void 0;try{for(var f=a[Symbol.iterator](),h;!(d=(h=f.next()).done);d=!0){var l=h.value,C=l.indexOf("=");if(-1===C)break;var z=l.substring(0,C),y=l.substring(C+1);if(z.startsWith("nand_")||y.startsWith("0x"))y=parseInt(y,16);b[z]=y}}catch(q){p=!0,g=q}finally{try{!d&&
f["return"]&&f["return"]()}finally{if(p)throw g;}}b.nandChip=e.findNand(b.nand_erasesize,b.nand_oobsize,b.nand_writesize);b.defaultNandChip=c;return b}},{key:"toNfsEnvironment",value:function(a,b){return"echo NFS Booting\nsetenv bootargs earlyprintk g_cdc.host_addr={0} root=/dev/nfs rw nfsroot=192.168.1.1:{1} ip=192.168.1.2 ${kernelarg_video}\nbootz 0x42000000 - 0x43000000".format(b||"00:11:22:33:44:55",a)}},{key:"commandToEnvironment",value:function(a){return"echo Executing custom command\n"+a+"\nmw ${scriptaddr} 0x0\nreset"}}]);
return e}();f.exportEnvironmentString=h;f.felScratch=4096;f.felEnvScratch=31744;f.felEnvScratchLength=512;l.exports=f},function(l,h,f){var g=f(14),m=null;chrome.runtime.onConnectExternal.addListener(function(c){m&&m.shutdown(!0);m=new g(c,!1)});chrome.runtime.onConnect.addListener(function(c){m?m.addPort(c):console.log("cannot connect app to popup")});chrome.app.runtime.onLaunched.addListener(function(c){console.log("on launched:",c);console.log("The application will be started automatically when you click on an image link at flash.getchip.com. If you want to load a local file without an internet connection, start the app from the Apps menu.")});
chrome.runtime.onStartup.addListener(function(c){console.log("onStartup")});chrome.runtime.onUpdateAvailable.addListener(function(c){console.log("need to update",c);chrome.runtime.reload()})},function(l,h,f){l.exports=function(){var g=[],f=0;this.getInternalQueue=function(){return g};this.getLength=function(){return g.length-f};this.isEmpty=function(){return 0===g.length};this.enqueue=function(c){g.push(c)};this.tail=function(){var c=g.length;if(0!==c)return g[c-1]};this.dequeue=function(){if(0!==
g.length){var c=g[f];g[f]=null;2*++f>=g.length&&(g=g.slice(f),f=0);return c}};this.peek=function(){return 0<g.length?g[f]:void 0};this.elementAt=function(c){return c>=g.length?null:g[c]}}},function(l,h,f){var g=function(){function a(b,a){for(var d=0;d<a.length;d++){var c=a[d];c.enumerable=c.enumerable||!1;c.configurable=!0;"value"in c&&(c.writable=!0);Object.defineProperty(b,c.key,c)}}return function(b,d,c){d&&a(b.prototype,d);c&&a(b,c);return b}}();f(0);var m=f(1),c=f(21);f(9);var a=m.LITTLE_ENDIAN,
e=m.stringToArr("AWUS");h=function(){function d(b){if(!(this instanceof d))throw new TypeError("Cannot call a class as a function");this.dataTransferHandler=b;this.diagnosticMode=!1}g(d,[{key:"waitForFel",value:function(b){var a=this.dataTransferHandler;return(b?a.resetChips():Promise.resolve()).then(function(){return a.initialize()}).then(a.waitForStatePromise.bind(a))}},{key:"ping",value:function(){return this.read(31744,8)["return"](!0)["catch"](function(){return!1})}},{key:"setDataProcessor",
value:function(b){this.dataProcessor=b}},{key:"read",value:function(b,a){var d=this;return this._request(259,b,a).then(this._usbRead.bind(this,a)).then(function(a){return d._status()["return"](a)})}},{key:"write",value:function(a,d){a instanceof Uint8Array&&(a=a.buffer);return this._request(257,d,a.byteLength).then(this._usbWrite.bind(this,a)).then(this._status.bind(this))}},{key:"writeUboot",value:function(a){return this.write(a,1241513984)}},{key:"writeZImage",value:function(a){return this.write(a,
1107296256)}},{key:"writeDtb",value:function(a){return this.write(a,1124073472)}},{key:"writeRootFs",value:function(a){return this.write(a,1127219200)}},{key:"writeUbootScript",value:function(b){var d=this;return this.write(c.toImage(b),1125122048).then(function(){var b=new ArrayBuffer(4);(new DataView(b)).setUint32(0,1125122048,a);return d.write(b,24)})}},{key:"exe",value:function(a){return this._request(258,a,0).then(this._status.bind(this))}},{key:"exeUboot",value:function(){return this.exe(1241513984)}},
{key:"getVersionSignature",value:function(){var a=this;return this._request(1,0,0).then(this._usbRead.bind(this,32)).then(function(b){b=m.subArrayToString(b,0,8);return a._status()["return"](b)})}},{key:"_request",value:function(b,d,c){var k=new ArrayBuffer(16),e=new DataView(k);e.setInt32(0,b,a);e.setInt32(4,d,a);e.setInt32(8,c,a);return this._usbWrite(k)}},{key:"_status",value:function(){return this._usbRead(8)}},{key:"_usbWrite",value:function(a){return this._usbRequest(18,a.byteLength).then(this._writeToUsb.bind(this,
a)).then(this._usbResponse.bind(this))}},{key:"_usbRead",value:function(a){var b=this;return this._usbRequest(17,a).then(this._readFromUsb.bind(this,a)).then(function(a){return b._usbResponse()["return"](a)})}},{key:"_usbRequest",value:function(b,d){var c=new ArrayBuffer(32),k=new DataView(c);m.copyStringIntoArrayBuffer("AWUC",c,0);k.setInt32(8,d,a);k.setInt32(12,201326592,a);k.setInt16(16,b,a);k.setInt32(18,d,a);return this._writeToUsb(c)}},{key:"_usbResponse",value:function(){return this._readFromUsb(13).then(function(a){var b=
new Uint8Array(a);if(0!==b[12])throw Error("USB Response returned "+b[12]);if(!m.arrayBufferEquals(e,a,!0))throw Error("Response was not AWUS");return!0})}},{key:"_writeToUsb",value:function(a){function b(d,c){var e=Math.min(a.byteLength-c,4194304);if(0>=e)return Promise.resolve(a);var k=new Uint8Array(a.slice(c,c+e));if(d.diagnosticMode){var g=d.dataProcessor.peekQueueFor("ExpectWrite");if(!m.arrayBufferEquals(g,k))throw Error("mistmatch in _writeToUsb");}return d.dataTransferHandler.writePromise(k).then(b.bind(null,
d,c+e))}return b(this,0).then(function(a){return a})}},{key:"_readFromUsb",value:function(a){function b(c,e){var k=Math.min(a-e,4194304);if(0>=k)return Promise.resolve(d);var g=new ArrayBuffer(k);return c.dataTransferHandler.readPromise(g,0,!0).then(function(a){if(c.diagnosticMode){var g=c.dataProcessor.peekQueueFor("ExpectRead");if(!m.arrayBufferEquals(g,a))throw Error("mismatch in reading _readFromUsb");}d.set(a,e);return b(c,e+k)})}var d=new Uint8Array(a);return b(this,0).then(function(a){return a})}}]);
return d}();l.exports=h},function(l,h,f){var g=function(){function a(a,d){for(var b=0;b<d.length;b++){var c=d[b];c.enumerable=c.enumerable||!1;c.configurable=!0;"value"in c&&(c.writable=!0);Object.defineProperty(a,c.key,c)}}return function(b,d,c){d&&a(b.prototype,d);c&&a(b,c);return b}}(),m=f(1),c={title:"Cancel Flashing",iconUrl:"images/Button-Close-icon.png"},a={title:"Close",iconUrl:"images/Button-Check-icon.png"},e={title:""};h=function(){function d(a){var b=this;if(!(this instanceof d))throw new TypeError("Cannot call a class as a function");
this.chromeApp=a;this.notificationId="CHIP Flasher";this.notificationOptions={};chrome.notifications.getPermissionLevel(function(a){"denied"===a&&(b.enabled=!1);b.enabled=!0});this.showingError=this.subscribed=this.userHidNotifications=!1}g(d,[{key:"hide",value:function(){chrome.notifications.clear(this.notificationId)}},{key:"update",value:function(a){this.enabled&&(a?(this.showingError=!1,this.notificationOptions={type:"progress",iconUrl:"images/icon-38.png",message:"Flashing",requireInteraction:!0,
buttons:[c,m.clone(e)],title:this.chromeApp.flashData.flashImage.name,progress:0,contextMessage:""},this.userHidNotifications=!1,chrome.notifications.create(this.notificationId,this.notificationOptions),this.subscribed||(this.subscribed=!0,this.subscribe())):this.showingError||(this.notificationOptions.progress=this.notificationOptions.progress||0,chrome.notifications.update(this.notificationId,this.notificationOptions)))}},{key:"showError",value:function(b){chrome.notifications.create(this.notificationId,
{type:"basic",iconUrl:"images/attention.png",title:"Error",requireInteraction:!0,message:b||"Error Occurred",buttons:[a]});this.showingError=!0}},{key:"subscribe",value:function(){var b=this,d=this.chromeApp.progress;d.addProgressObserver(function(a){b.notificationOptions.progress=a.percent;a.estimatedTimeRemaining&&(b.notificationOptions.contextMessage=a.percent+"%",b.notificationOptions.message=a.stage);b.update()});d.addStateObserver(function(d){d.error&&b.showError(d.error.text);"Done"===d.stage&&
(b.notificationOptions.message=d.stage,b.userHidNotifications&&chrome.notifications.create(b.notificationId,b.notificationOptions),b.notificationOptions.buttons[0]=a,b.notificationOptions.contextMessage="You may unplug your device");b.update()});d.addDataObserver(function(a){a.md5Hash&&!b.chromeApp.flashData.flashImage.url&&(b.notificationOptions.buttons[1].title="MD5: "+a.md5Hash,b.update())});chrome.notifications.onButtonClicked.addListener(function(a,d){if(0===d&&(chrome.notifications.clear(a),
b.notificationOptions.buttons[0]===c))return b.chromeApp.flashInProgress=!1,b.chromeApp.flasher.cancel()});chrome.notifications.onClosed.addListener(function(a){b.userHidNotifications=!0})}}]);return d}();l.exports=h},function(l,h,f){var g=function(){function a(a,b){for(var d=0;d<b.length;d++){var c=b[d];c.enumerable=c.enumerable||!1;c.configurable=!0;"value"in c&&(c.writable=!0);Object.defineProperty(a,c.key,c)}}return function(b,d,c){d&&a(b.prototype,d);c&&a(b,c);return b}}(),m=f(20),c=f(2),a=f(8),
e=f(0),d=f(15),b=f(13);h=function(){function k(g,f){var p=this;if(!(this instanceof k))throw new TypeError("Cannot call a class as a function");this.startedExplicitly=f;e.trackFunc=function(a,b){p.postMessage({track:{message:a,obj:b}})};e.analyticsFunc=function(a){p.postMessage({analytics:a})};var h=!("update_url"in chrome.runtime.getManifest());(e.development=h)&&Promise.config({warnings:!0,longStackTraces:!0,cancellation:!0,monitoring:!0});this.dead=!1;this.ports=new Set;this.progress=new c;this.factory=
new d;this.flasher=null;this.flashData={maxChips:a.MAX_CHIPS};this.flasher=this.pollingInterval=null;this.init();g&&this.addPort(g);this.addObservers();this.browserNotification=new b(this)}g(k,[{key:"shutdown",value:function(a){this.browserNotification.hide();this.pollingInterval&&clearInterval(this.pollingInterval);this.dead=!0;this.port=null;this.progress&&this.progress.cleanUp();this.flashData=this.flasher=this.progress=null}},{key:"init",value:function(){this.flashData.stub=null;this.flashData.nand=
null;this.flashData.logLevel=null;this.flashData.headless=!0;this.flashData.autoStart=!0;this.flashData.flashImage=null;this.flashData.development=e.development;this.flashInProgress=this.done=!1;this.progress.init();this.flasher?this.flasher.init():this.flasher=new m(this.factory,this.progress);this.pollForDeviceChanges(!1)}},{key:"pollForDeviceChanges",value:function(a){var b=this;void 0===a&&(a=!0);a?this.pollingInterval||(this.pollingInterval=setInterval(function(){b.flashInProgress||b.done||b.dead||
b.flasher.readingEnvironment||b.flasher.getDeviceCount()["catch"](function(a){clearInterval(b.pollingInterval);b.pollingInterval=null;console.log("got error getDeviceCount",a);b.postMessage({error:a})})},1E3)):this.pollingInterval&&(clearInterval(this.pollingInterval),this.pollingInterval=null)}},{key:"addObservers",value:function(){var a=this;this.progress.addDeviceObserver(function(b){a.postMessage({devices:b})});this.progress.addProgressObserver(function(b){a.postMessage({progress:b})});this.progress.addDataObserver(function(b){a.postMessage({data:b})});
this.progress.addErrorObserver(function(b){a.postMessage({error:b})});this.progress.addStateObserver(function(b){if(b.state===c.FAIL_STATE||b.state===c.PASS_STATE)e.info("setting flashInProgress to false"),a.flashInProgress=!1,a.done=!0;a.postMessage({stateUpdate:b})})}},{key:"addPort",value:function(a){e.info("add port called");this.ports.add(a);this.addPortListeners(a)}},{key:"removePort",value:function(a){this.ports["delete"](a)}},{key:"postMessage",value:function(a,b){if(b)this.ports.has(b)&&
b.postMessage(a);else{var d=!0,c=!1,e=void 0;try{for(var k=this.ports[Symbol.iterator](),g;!(d=(g=k.next()).done);d=!0)g.value.postMessage(a)}catch(y){c=!0,e=y}finally{try{!d&&k["return"]&&k["return"]()}finally{if(c)throw e;}}}}},{key:"createWindow",value:function(a){var b=this,d=this;return new Promise(function(c){chrome.app.window.create("popup.html",{innerBounds:{width:200,height:200},resizable:!1,frame:"none",hidden:!0},function(e){d.appWindow=e;d.appWindow.onClosed.addListener(function(){d.appWindow=
null});e=d.appWindow.contentWindow;e.flashData=d.flashData;e.startedExplicitly=b.startedExplicitly;console.log("startedExplicitly",e.startedExplicitly);a&&(e.request=a);return c(!0)})})}},{key:"addPortListeners",value:function(a){var b=this,d=this;a.onMessage.addListener(function(c,k){b.dead||(void 0!==c.lookForChip&&b.pollForDeviceChanges(c.lookForChip),c.nand&&(b.flashData.nand=c.nand,b.flasher.forceNand(c.nand)),c.stub&&(b.flashData.stub=c.stub),c.headless&&(b.flashData.headless=c.headless),c.start&&
(b.flashData.start=!0),c.logLevel&&(b.flashData.logLevel=c.logLevel,e.setLevel(b.logLevel)),c.getVersion?b.postMessage({version:chrome.runtime.getManifest().version,development:e.development}):c.ping?b.postMessage({connect:!0},a):void 0!==c.init?c.init?chrome.runtime.reload():b.init():c.deviceCount?b.flasher.getDeviceCount():void 0!==c.setDevice?b.flasher.setDevice(c.setDevice):c.setEnvironment?b.flasher.setEnvironment(c.setEnvironment):c.getEnvironment?b.flasher.getEnvironment():c.flashImage?b.flashInProgress?
e.info("ignoring click, flash in progress"):(b.flashData.flashImage=c.flashImage,b.done=!1,b.pollForDeviceChanges(!0),b.sendRequestToPopup({func:c.flashImage.url?"empty":"openFile",callback:"startFlashing"})):c.startFlashing?(d.appWindow.close(),c.startFlashing.result?b.startFlashing():b.postMessage({cancel:"openFile"})):c.ubootCommand?b.flasher.setUbootCommand(c.ubootCommand):c.shutdown&&b.shutdown(!1))});a.onDisconnect.addListener(function(d){b.removePort(a)})}},{key:"startFlashing",value:function(){var a=
this;this.progress.init();this.flashInProgress=!0;this.progress.notifyProgress();this.browserNotification.update(!0);Promise.resolve().then(function(){return a.flasher.flash(a.flashData)})["catch"](function(b){e.info("error on flash "+b);a.init()})}},{key:"sendRequestToPopup",value:function(a){return this.appWindow?(this.postMessage(a),Promise.resolve(!1)):this.createWindow(a)}}]);return k}();l.exports=h},function(l,h,f){function g(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+
typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var m=function(){function a(a,d){for(var b=0;b<d.length;b++){var c=d[b];c.enumerable=c.enumerable||!1;c.configurable=!0;"value"in c&&(c.writable=!0);Object.defineProperty(a,c.key,c)}}return function(b,d,c){d&&a(b.prototype,d);c&&a(b,c);return b}}();h=f(19);var c=f(22),a=f(16),e=f(7);f=function(d){function b(){if(!(this instanceof
b))throw new TypeError("Cannot call a class as a function");var a=(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!a||"object"!==typeof a&&"function"!==typeof a?this:a}g(b,d);m(b,[{key:"createStreamHandler",value:function(a,b,d,g){return d?new e(a,b):new c(a,b)}},{key:"createDeviceHandler",value:function(){return new a}},{key:"chooseFile",value:function(a,b){var d={type:"openFile"};a&&
(d.suggestedName=a);b&&(d.accepts=[{extensions:[b]}]);return(new Promise(function(a,b){chrome.fileSystem.chooseEntry(d,function(d){if(chrome.runtime.lastError)return b(Error(chrome.runtime.lastError.message));a(d)})})).then(function(a){if(!a)throw Error("No file");return new Promise(function(b,d){a.file(function(d){b([d,a.fullPath])})})})}},{key:"openFileByName",value:function(a,b){var d={};b&&(d.volumeId=b);return(new Promise(function(a,b){chrome.fileSystem.requestFileSystem(d,function(d){if(chrome.runtime.lastError)return b(Error(chrome.runtime.lastError.message));
a(d)})})).then(function(b){return new Promise(function(d,c){b.root.getFile(a,{},function(a){d(a)})})}).then(function(a){if(!a)throw Error("No file");return new Promise(function(b,d){a.file(function(a){b(a)})})})}}]);return b}(h);l.exports=f},function(l,h,f){function g(a,c){if("function"!==typeof c&&null!==c)throw new TypeError("Super expression must either be null or a function, not "+typeof c);a.prototype=Object.create(c&&c.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});
c&&(Object.setPrototypeOf?Object.setPrototypeOf(a,c):a.__proto__=c)}var m=function(){function a(a,d){for(var b=0;b<d.length;b++){var c=d[b];c.enumerable=c.enumerable||!1;c.configurable=!0;"value"in c&&(c.writable=!0);Object.defineProperty(a,c.key,c)}}return function(c,d,b){d&&a(c.prototype,d);b&&a(c,b);return c}}(),c=f(0);h=function(a){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");var a;a=(e.__proto__||Object.getPrototypeOf(e)).call(this);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
a=!a||"object"!==typeof a&&"function"!==typeof a?this:a;a.timeout=3E5;a.configurationValue=1;return a}g(e,a);m(e,[{key:"getDevicesPromise",value:function(a,b){var d={};d.vendorId=a;d.productId=b;var c={filters:[d]};return new Promise(function(a,b){chrome.usb.getDevices(c,function(d){if(chrome.runtime.lastError)return b(Error(chrome.runtime.lastError.message));a(d)})})}},{key:"openChipPromise",value:function(a){var b=this;return(new Promise(function(b,d){chrome.usb.openDevice(a.device,function(c){if(chrome.runtime.lastError)return d(Error(chrome.runtime.lastError.message));
a.handle=c;b(c)})})).then(function(d){return new Promise(function(e,g){chrome.usb.getConfigurations(a.device,function(a){if(chrome.runtime.lastError)return g(Error(chrome.runtime.lastError.message));if(a&&0<a.length)c.info("Configuration count"+a.length),a=a[0].configurationValue,c.info("USB Config value="+a);else return c.error("No USB config found."),g(Error(b.NO_CONFIG));e([d,a])})})}).then(function(b){var d=b[0],e=b[1];return new Promise(function(b,g){chrome.usb.setConfiguration(d,e,function(){if(chrome.runtime.lastError)return c.info("Could not set configuration to "+
e),c.info(a),g(Error(chrome.runtime.lastError.message));c.info("Set usb device configuration to "+e);b(d)})})}).then(function(a){return new Promise(function(b,d){chrome.usb.listInterfaces(a,function(c){if(chrome.runtime.lastError)return d(Error(chrome.runtime.lastError.message));b([a,c])})})}).then(function(d){var c=d[0],e=d[1],g=null;d=!0;var k=!1,f=void 0;try{for(var h=e[Symbol.iterator](),m;!(d=(m=h.next()).done);d=!0){var l=m.value,q=l.endpoints,e=!0,v=!1,A=void 0;try{for(var B=q[Symbol.iterator](),
E;!(e=(E=B.next()).done);e=!0){var D=E.value;"bulk"===D.type&&("in"===D.direction?(a.inEp=D,g=l):"out"===D.direction&&(a.outEp=D,g=l))}}catch(F){v=!0,A=F}finally{try{!e&&B["return"]&&B["return"]()}finally{if(v)throw A;}}if(g){if(null===a.inEp||null===a.outEp)throw Error(b.COULD_NOT_CLAIM_INTERFACES);break}}}catch(F){k=!0,f=F}finally{try{!d&&h["return"]&&h["return"]()}finally{if(k)throw f;}}return new Promise(function(b,d){chrome.usb.claimInterface(c,g.interfaceNumber,function(){if(chrome.runtime.lastError)return d(Error(chrome.runtime.lastError.message));
a.goodChip=!0;b(a)})})})["catch"](function(d){c.info("caught usb config error"+d);if(a.handle)return b.closePromise(a).then(function(){return null});throw d;})}},{key:"writePromise",value:function(a,b){var d={direction:"out"};d.endpoint=a.outEp.address;d.data=b.buffer;d.length=b.byteLength;d.timeout=this.timeout;return new Promise(function(e,g){chrome.usb.bulkTransfer(a.handle,d,function(a){if(chrome.runtime.lastError)return c.info("Error writing"),c.error(chrome.runtime.lastError),g(Error(chrome.runtime.lastError.message));
0===a.resultCode?e(b.byteLength):e(0)})})}},{key:"readPromise",value:function(a,b){var d={direction:"in"};d.endpoint=a.inEp.address;d.length=b.byteLength;d.timeout=this.timeout;return new Promise(function(b,e){chrome.usb.bulkTransfer(a.handle,d,function(a){if(chrome.runtime.lastError)return c.error("Error reading"),c.error(chrome.runtime.lastError),e(Error(chrome.runtime.lastError.message));0===a.resultCode?b(new Uint8Array(a.data)):b(null)})})}},{key:"closePromise",value:function(a){return new Promise(function(b,
d){chrome.usb.closeDevice(a.handle,function(){a.init();if(chrome.runtime.lastError)return d(Error(chrome.runtime.lastError.message));b(!0)})})}},{key:"resetPromise",value:function(a){return new Promise(function(b,d){chrome.usb.resetDevice(a.handle,function(){a.init();if(chrome.runtime.lastError)return d(Error(chrome.runtime.lastError.message));b(!0)})})}}]);return e}(f(6));l.exports=h},function(l,h,f){function g(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function m(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}var a=function G(a,b,d){null===a&&
(a=Function.prototype);var c=Object.getOwnPropertyDescriptor(a,b);if(void 0===c){if(a=Object.getPrototypeOf(a),null!==a)return G(a,b,d)}else{if("value"in c)return c.value;b=c.get;return void 0===b?void 0:b.call(d)}},e=function(){function a(a,b){for(var d=0;d<b.length;d++){var c=b[d];c.enumerable=c.enumerable||!1;c.configurable=!0;"value"in c&&(c.writable=!0);Object.defineProperty(a,c.key,c)}}return function(b,d,c){d&&a(b.prototype,d);c&&a(b,c);return b}}(),d=f(0),b=f(11);f(5);var k=f(2),p=f(1),t=
f(8),u=f(18),x=f(4),w=function(){function a(b,d){c(this,a);this.dataProcessor=b;this.dataLength=d;this.id=++b.expectCount}e(a,[{key:"clean",value:function(){this.buffer=this.dataProcessor=null}},{key:"parseAndGetNext",value:function(a){this.buffer=a;return new z(this.dataProcessor)}},{key:"process",value:function(){return!0}},{key:"isPlayedBack",value:function(){return!0}},{key:"isUncompressedWrite",value:function(){return!1}},{key:"isReadOrWrite",value:function(){return!1}},{key:"kind",value:function(){return"Expect"}}]);
return a}(),C=function(a){function b(a,d){c(this,b);var e=g(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,0));e.fn=d;return e}m(b,a);e(b,[{key:"process",value:function(){var a=this;return Promise.resolve().then(function(){return a.fn()})}},{key:"kind",value:function(){return"ExpectMeta"}}]);return b}(w),z=function(a){function b(a,d){c(this,b);var e=g(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,12));e.first=d;return e}m(b,a);e(b,[{key:"parseMagicNumberAndEndian",value:function(a){d.debug("Parsing magic and endian");
for(var b=0,c=[!0,!1],e=0;e<c.length;e++){var n=c[e],b=(new DataView(a.buffer,0,4)).getUint32(0,n);d.debug(b.toString(16));if(523956200===b){d.debug("Reading FEL Data");break}else if(523898896===b){d.debug("Reading FASTBOOT Data");break}else if(0===b)d.debug("Ignoring 0 magic");else{if(3978755898===b)throw d.debug("The file is a sparse file. It must be processed with howitzer"),Error("Bad file format. This is a raw sparse file");if(!n)throw d.debug("Uh oh The file is not valid"),Error("Bad file format");
}}return[b,n]}},{key:"parseAndGetNext",value:function(a){var b=new DataView(a.buffer,4,3),c=b.getUint8(0);this.command=c;var e=null;if(this.first||0===c){var n=this.parseMagicNumberAndEndian(a),e=n[0];this.dataProcessor.endian=n[1]}var r=this.dataProcessor.endian,H=new DataView(a.buffer,0,4),n=H.getUint32(0,r),g=b.getUint8(1),f=parseInt(b.getUint8(2)),H=new DataView(a.buffer,8,4);a=H.getUint32(0,r);2<f&&(d.error(this),d.error(f+" "+g+" "+n+" "+a+" "+b.getUint8(2)),d.error("Recorder version="+f+" Player version=2"),
this.dataProcessor.badVer=!0);if(0===c)return new y(this.dataProcessor,e,a,f);if(5===c)return new A(this.dataProcessor,a);if(1===c)return new v(this.dataProcessor,a);if(4===c)return new J(this.dataProcessor,n);if(2===c)return new B(this.dataProcessor,g,a);if(3===c)return new E(this.dataProcessor,g,a);if(6===c)return new D(this.dataProcessor,g,a,n);if(7===c)return new F(this.dataProcessor,a,n);if(8===c)return new K(this.dataProcessor,a,n);d.info("Ignoring unknown command: "+c);return new w(this.dataProcessor,
a)}},{key:"isPlayedBack",value:function(){return!1}},{key:"kind",value:function(){return this.id+" ExpectHeader"}}]);return b}(w),y=function(a){function b(a,d,e,f){c(this,b);a=g(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,0));a.magicNumber=d;a.recorderVersion=f;a.fileLength=e;return a}m(b,a);e(b,[{key:"parseAndGetNext",value:function(a){this.magicNumber!==this.dataProcessor.magicNumber&&(1!==this.recorderVersion&&0!==this.dataProcessor.totalBytes||this.dataProcessor.addTotalBytes(this.fileLength),
this.dataProcessor.magicNumber=this.magicNumber,d.debug("MAGIC - read: "+this.magicName()+" file length: "+this.fileLength));return new z(this.dataProcessor)}},{key:"vidPid",value:function(){return p.magicToVidPid(this.magicNumber)}},{key:"magicName",value:function(){return 523956200===this.magicNumber?"FEL":523898896===this.magicNumber?"FASTBOOT":"UNKNOWN"}},{key:"waitTimeout",value:function(){if(523956200===this.magicNumber)return 1E4;if(523898896===this.magicNumber)return 35E3}},{key:"magicLabel",
value:function(a,b){if(523956200===a)return b?k.WAITING_FOR_FEL:k.FEL;if(523898896===a)return b?k.WAITING_FOR_FASTBOOT:k.FASTBOOT}},{key:"process",value:function(){var a=this,b=this.vidPid(),c=this.dataProcessor;c.progress.notifyStage(this.magicLabel(this.magicNumber,!0));var e=c.dataTransferHandler,n=c.currentProcessingMagic&&this.magicNumber!==c.currentProcessingMagic,b=e.waitForStatePromise(b[0],b[1],c.flashingCount,this.waitTimeout(),n).then(function(b){d.info("---Process magic "+a.magicName());
if(!b)return!1;c.currentProcessingMagic=a.magicNumber;c.progress.notifyStage(a.magicLabel(a.magicNumber,!1));return!0});c.skipUntilMagic===this.magicNumber&&(c.skipUntilMagic=null,b.then(function(){return x.eraseUBI(e)}));c.firstMagic=c.firstMagic||this.magicNumber;c.lastMagic=this.magicNumber;return b}},{key:"kind",value:function(){return this.id+" MAGIC"}}]);return b}(w),q=function(a){function b(a,d){c(this,b);return g(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,d,0,0))}m(b,a);e(b,
[{key:"process",value:function(){var a=this,b=this.vidPid();return this.dataProcessor.deviceHandler.getDevicesPromise(b[0],b[1]).then(function(b){d.info("Magic check");0<b.length&&(a.dataProcessor.skipUntilMagic=a.magicNumber)})}},{key:"parseAndGetNext",value:function(a){return null}},{key:"kind",value:function(){return this.id+" MAGIC CHECK"}}]);return b}(y),v=function(a){function b(a,d){c(this,b);return g(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,d))}m(b,a);e(b,[{key:"process",value:function(){return Promise.resolve(this.buffer).then(function(a){d.info("Comment: "+
p.arrToString(a));return!0})}},{key:"kind",value:function(){return this.id+" ExpectComment"}}]);return b}(w),A=function(b){function f(a,b){c(this,f);return g(this,(f.__proto__||Object.getPrototypeOf(f)).call(this,a,b))}m(f,b);e(f,[{key:"parseAndGetNext",value:function(b){var c=p.arrToString(b,!0);d.info(c);this.contents=JSON.parse(c);this.dataProcessor.manifest=this.contents;return a(f.prototype.__proto__||Object.getPrototypeOf(f.prototype),"parseAndGetNext",this).call(this,b)}},{key:"process",value:function(){var a=
this;return Promise.resolve(this.buffer).then(function(b){d.info("Manifest: "+a.contents);return!0})}},{key:"kind",value:function(){return this.id+" ExpectManifest"}}]);return f}(w),B=function(a){function b(a,d,e){c(this,b);a=g(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,e));a.compressed=d;a.allowFailure=!1;a.dataProcessor.continueReached&&(a.allowFailure=!0);return a}m(b,a);e(b,[{key:"process",value:function(){return this.dataProcessor.dataTransferHandler.readPromise(this.buffer,this.id,
this.allowFailure)}},{key:"kind",value:function(){return this.id+" ExpectRead "+this.dataLength}},{key:"isReadOrWrite",value:function(){return!0}}]);return b}(w),E=function(b){function f(a,b,d){c(this,f);a=g(this,(f.__proto__||Object.getPrototypeOf(f)).call(this,a,d));a.compressed=b;return a}m(f,b);e(f,[{key:"parseAndGetNext",value:function(b){x.isContinue(b)&&(d.info("Continue reached"),this.dataProcessor.continueReached=!0);return a(f.prototype.__proto__||Object.getPrototypeOf(f.prototype),"parseAndGetNext",
this).call(this,b)}},{key:"process",value:function(){return this.dataProcessor.dataTransferHandler.writePromise(this.buffer,this.id)}},{key:"isUncompressedWrite",value:function(){return!this.compressed}},{key:"isReadOrWrite",value:function(){return!0}}]);return f}(w),D=function(a){function b(a,d,e,f){c(this,b);a=g(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,e));a.compressed=d;a.address=f;return a}m(b,a);e(b,[{key:"process",value:function(){return this.dataProcessor.felInstance.write(this.buffer,
this.address)}},{key:"isReadOrWrite",value:function(){return!0}},{key:"kind",value:function(){return this.id+" ExpectFelWrite "+this.dataLength}}]);return b}(w),F=function(a){function b(a,d,e){c(this,b);a=g(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,d));a.address=e;return a}m(b,a);e(b,[{key:"process",value:function(){return this.dataProcessor.felInstance.read(this.address,this.dataLength)}},{key:"isReadOrWrite",value:function(){return!0}},{key:"kind",value:function(){return this.id+
" ExpectFelRead "+this.address+" "+this.dataLength}}]);return b}(w),K=function(a){function b(a,d,e){c(this,b);a=g(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,d));a.address=e;return a}m(b,a);e(b,[{key:"process",value:function(){return this.dataProcessor.felInstance.exe(this.address)}},{key:"isReadOrWrite",value:function(){return!0}},{key:"kind",value:function(){return this.id+" ExpectFelExe "+this.address}}]);return b}(w),J=function(a){function b(a,d){c(this,b);var e=g(this,(b.__proto__||
Object.getPrototypeOf(b)).call(this,a,0));e.microseconds=d;return e}m(b,a);e(b,[{key:"process",value:function(){return Promise.delay(this.microseconds/1E3)}},{key:"kind",value:function(){return this.id+" Usleep"}}]);return b}(w);h=function(){function a(b,d){c(this,a);this.dataTransferHandler=b;this.deviceHandler=this.dataTransferHandler.deviceHandler;this.progress=d;this.spark=new SparkMD5.ArrayBuffer;this.initialize();this.state=null}e(a,[{key:"initialize",value:function(){this.expectCount=0;this.dataTransferHandler.initialize();
this.littleEndian=!1;this.readBuffer=null;this.expect=new z(this,!0);this.enqueuedItems=this.bytesWritten=this.totalBytes=0;this.queue=new b;this.reject=this.head=null;this.magicNumber=0;this.skipUntilMagic=null;this.spark.reset();this.continueReached=!1;this.setState(k.PASSIVE_STATE);this.lastMagic=this.firstMagic=null;this.setInitialDeviceCount();this.checkForFastboot();this.felStateCount=this.currentProcessingMagic=this.queueDiagnosticSpot=0;this.environment=null;this.needToCheckFileCompatibility=
!1;this.manifest=this.felInstance=null}},{key:"resetByteCounts",value:function(){this.enqueuedItems=this.bytesWritten=this.totalBytes=0;this.state=k.PASSIVE_STATE;this.magicNumber=0;this.spark=new SparkMD5.ArrayBuffer;this.currentProcessingMagic=0;this.manifest=null}},{key:"storeDataIfNeeded",value:function(a){523956200===this.currentProcessingMagic&&a.isReadOrWrite()&&(1===this.felStateCount&&(a=new DataView(a.buffer.buffer),258===a.getUint16(0,p.LITTLE_ENDIAN)&&(1073741824<=a.getUint32(4,p.LITTLE_ENDIAN)&&
(this.dataTransferHandler.forceWaitForState=!0),this.felStateCount+=3)),this.felStateCount=(this.felStateCount+1)%9)}},{key:"setEnvironment",value:function(a){d.info("Setting environment",a);this.needToCheckFileCompatibility=!0;this.environment=a}},{key:"setFelInstance",value:function(a){this.felInstance=a}},{key:"calcHash",value:function(){if(this.spark){var a=this.spark.end();this.progress.notifyData({serialNumbers:this.dataTransferHandler.serialNumbers,md5Hash:a});return a}return null}},{key:"setInitialDeviceCount",
value:function(){var a=this;this.addMeta(function(){return a.dataTransferHandler.getDeviceCount2(523956200,523898896).then(function(b){a.initialDeviceCount=b;b>t.MAX_CHIPS&&(b=t.MAX_CHIPS,a.notifyState(Error("C.H.I.P.s detected = "+b+", but can only flash "+t.MAX_CHIPS)));return a.flashingCount=b})})}},{key:"checkForFastboot",value:function(){var a=new q(this,523898896);this.addToQueue(a)}},{key:"startedWithFastboot",value:function(){return 523898896===this.firstMagic}},{key:"setState",value:function(a){a!==
this.state&&(this.state=a,this.notifyState())}},{key:"addTotalBytes",value:function(a){this.totalBytes+=a;this.progress.setTotalBytes(this.totalBytes)}},{key:"setStreamHandler",value:function(a){this.streamHandler=a}},{key:"addToQueue",value:function(a){this.enqueuedItems++;this.queue.enqueue(a);1===this.queue.getLength()&&(d.debug("processing head"),this.processHead());0<a.dataLength&&this.streamHandler.addBytes(a.dataLength)}},{key:"removeFromQueue",value:function(a){if(this.state!==k.FAIL_STATE)return this.enqueuedItems--,
this.storeDataIfNeeded(a),a.clean(),this.queue.dequeue(),this.streamHandler&&d.info("removed "+a.kind()+" len "+a.dataLength+" from queue. Now at  "+this.streamHandler.enqueuedBytes+"bytes, items="+this.enqueuedItems),this.processHead(),this.progress.addBytes(a.dataLength,this.enqueuedItems),this.streamHandler&&this.streamHandler.addBytes(-a.dataLength),!0}},{key:"addMeta",value:function(a){this.addToQueue(new C(this,a))}},{key:"addCleanUpMeta",value:function(a){var b=this;this.addMeta(function(){return b.cleanUpPromise().then(function(){d.meta("Flashing finished! Elapsed time: "+
((new Date).getTime()-a)/1E3);return!0})})}},{key:"processHead",value:function(){var a=this;if(!p.enqueueOnly){if(this.dataTransferHandler.errorState)return d.error("aborting in processHead"),this.handleError(this.dataTransferHandler.errorState);(this.head=this.queue.peek())&&(this.skipUntilMagic&&this.head.magicNumber!==this.skipUntilMagic?this.removeFromQueue(this.head):this.head.process()["catch"](Error,function(b){d.info("caught error in process head and calling handlError"+b);return a.handleError(b)}).then(function(){if(a.state!==
k.FAIL_STATE)return a.removeFromQueue(a.head)}))}}},{key:"isDone",value:function(){return this.state===k.FAIL_STATE||this.state===k.PASS_STATE}},{key:"handleError",value:function(a){var c=this;if(this.state===k.FAIL_STATE)return!1;d.info("Handling error");d.info(a);this.state=k.FAIL_STATE;var e={error:a,text:a.toString()};e.report=a instanceof u.ReportableError;this.head&&(e.index=this.head.id,e.operation=this.head.kind());d.error(e);this.queue=new b;this.notifyState(e);return this.cleanUpPromise().then(function(){d.info("cleaned up after error");
if(c.reject)return console.log("calling reject"),a instanceof Error||(a=Error(a)),c.reject(a);console.log("not calling reject, none set");throw a;})}},{key:"notifyState",value:function(a){var b={state:this.state};a&&(b.error=a);b.startedWithFastboot=this.startedWithFastboot();b.booting=this.continueReached;b.initialDeviceCount=this.initialDeviceCount;b.flashingCount=this.flashingCount;b.serialNumbers=this.dataTransferHandler.serialNumbers;a&&console.log("notifyState error",b);this.progress.notifyState(b)}},
{key:"cleanUpPromise",value:function(){var a=this;return this.dataTransferHandler.closeAllExcept(0,0)["catch"](function(a){d.info("Error on cleanup");d.info(a);return null}).then(function(){d.info("Closed all devices");a.state!==k.FAIL_STATE&&(a.state=k.PASS_STATE,a.notifyState());a.progress.notifyStage(k.DONE);return!0})}},{key:"processChunk",value:function(a){this.spark&&this.spark.append(a);if(this.state===k.FAIL_STATE)return!1;this.setState(k.ACTIVE_STATE);this.readBuffer=this.readBuffer?p.appendBuffer(this.readBuffer,
a):a;try{for(;this.readBuffer.byteLength>=this.expect.dataLength;){var b=this.expect;a=null;0<b.dataLength&&(a=this.readBuffer.slice(0,b.dataLength),this.readBuffer=this.readBuffer.slice(b.dataLength));this.expect=b.parseAndGetNext(a);this.checkCompatibility(b);b.isPlayedBack()&&this.addToQueue(b)}}catch(M){return this.handleError(M)}return!0}},{key:"checkCompatibility",value:function(a){if(this.needToCheckFileCompatibility&&a.isReadOrWrite()){this.needToCheckFileCompatibility=!1;a=this.environment;
if(!a||a.nfsBoot||!a.nandChip)return!0;if(this.manifest){if(this.manifest.nandChip&&"Toshiba_512M_MLC"===this.manifest.nandChip.id&&(console.log("Fixing nandChip id: Toshiba_512M_MLC -> Toshiba_512M_SLC"),this.manifest.nandChip.id="Toshiba_512M_SLC"),!this.manifest.initrd&&this.manifest.nandChip&&this.manifest.nandChip.id!==a.nandChip.id)return a=new u.CompatibilityError(this.manifest.nandChip.id,a.nandChip.id),this.handleError(a)}else{if(a.nandChip!==a.defaultNandChip)return a=new u.CompatibilityError(a.defaultNandChip.id,
a.nandChip.id),this.handleError(a);d.info("No manifest, but file is compatible with this chip")}}}},{key:"peekQueueFor",value:function(a){for(;;){var b=this.queue.elementAt(this.queueDiagnosticSpot);if(!b)throw Error("peekQueueFor past end: "+this.queueDiagnosticSpot);this.queueDiagnosticSpot++;if(b.kind().includes(a))return b.buffer;if(b instanceof B||b instanceof E)throw Error("Expecting "+a+" but got "+b.kind());}}}]);return a}();l.exports=h},function(l,h,f){function g(a,c){if(!(a instanceof c))throw new TypeError("Cannot call a class as a function");
}function m(a,c){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!c||"object"!==typeof c&&"function"!==typeof c?a:c}function c(a,c){if("function"!==typeof c&&null!==c)throw new TypeError("Super expression must either be null or a function, not "+typeof c);a.prototype=Object.create(c&&c.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});c&&(Object.setPrototypeOf?Object.setPrototypeOf(a,c):a.__proto__=c)}h=function(a){function e(){g(this,
e);return m(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}c(e,a);return e}(Error);f=function(a){function e(a,b){g(this,e);var d=m(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,"The .chp file you are using was built for CHIPS with "+a+" NAND, is not compatible with your NAND type: "+b+". If you wish to flash from a .chp file, you will need to download it again from flash.getchip.com"));d.chpFileType=a;d.nandType=b;return d}c(e,a);return e}(h);l.exports={ReportableError:h,
CompatibilityError:f}},function(l,h,f){var g=function(){function g(c,a){for(var e=0;e<a.length;e++){var d=a[e];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(c,d.key,d)}}return function(c,a,e){a&&g(c.prototype,a);e&&g(c,e);return c}}();h=function(){function f(){if(!(this instanceof f))throw new TypeError("Cannot call a class as a function");}g(f,[{key:"createStreamHandler",value:function(c,a,e,d){}},{key:"createDeviceHandler",value:function(){}},
{key:"chooseFile",value:function(c,a){}},{key:"openFileByName",value:function(c,a){}}]);return f}();l.exports=h},function(l,h,f){var g="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"===typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},m=function(){function a(a,b){for(var d=0;d<b.length;d++){var c=b[d];c.enumerable=c.enumerable||!1;c.configurable=!0;"value"in c&&(c.writable=!0);Object.defineProperty(a,
c.key,c)}}return function(b,d,c){d&&a(b.prototype,d);c&&a(b,c);return b}}(),c=f(17),a=f(23),e=f(5),d=f(4),b=f(2),k=f(9);f(7);var p=f(3),t=f(12),u=f(0),x=f(1);h=function(){function f(a,b,d){if(!(this instanceof f))throw new TypeError("Cannot call a class as a function");this.factory=a;this.progress=b;this.deviceHandler=this.factory.createDeviceHandler();this.dataTransferHandler=new e(this.deviceHandler);this.isWindows=-1!==navigator.appVersion.indexOf("Win");this.env=this.felInstance=null;this.testingFel=
this.doingUbootCommand=this.readingEnvironment=!1;this.lastCount=0;this.ubootCommand=this.nand=null;this.waitForFastbootDriverDelay=this.isWindows?25E3:0;this.waitForFELDriverDelay=0}m(f,[{key:"setEnvironment",value:function(a){this.env=a}},{key:"init",value:function(){this.env=null;this.testingFel=this.doingUbootCommand=this.readingEnvironment=!1;this.lastCount=0;this.dataProcessor=this.felInstance=this.env=this.nand=null;this.progress.init();if(this.dataTransferHandler)return this.dataTransferHandler.closeAllExcept()}},
{key:"setUbootCommand",value:function(a){this.ubootCommand=a}},{key:"forceNand",value:function(a){u.info("forcing Nand",a);this.nand=a}},{key:"onDeviceAddRemove",value:function(a){this.getDeviceCount()}},{key:"countDevices",value:function(){return this.getDeviceCount(null,null,!0).then(function(a){return a})}},{key:"getDeviceCount",value:function(a,b,d){var c=this;a=a||7994;b=b||61416;return this.readingEnvironment||this.doingUbootCommand||!this.deviceHandler?Promise.resolve(0):this.deviceHandler.getDevicesPromise(a,
b).then(function(a){return a&&0<a.length?Promise.resolve(a):Promise.resolve([])}).then(function(a){var b=a.length;a=x.listSerialNumbers(a);var e=c.lastCount<b,f=c.lastCount>b;c.progress.notifyDeviceCount(b,a,c.lastCount);c.lastCount=b;if(d)return b;if(e){if(a=function(){if(c.testingFel)return{v:void 0};c.prepareFlash();var a=c.fel(),d=c.dataTransferHandler;return{v:c.dataTransferHandler.waitForStatePromise().then(a.getVersionSignature.bind(a)).timeout(3E3,"timout reading version signature").then(c.processVersionSignature.bind(c)).then(function(){return c.isWindows?
d.closeAllExcept():Promise.resolve()}).then(c.sendPendingUbootCommandIfAny.bind(c)).then(c.readEnvironment.bind(c)).then(function(a){if(!a)return b;c.env=a;c.dataProcessor.setEnvironment(a);c.dataProcessor.resetByteCounts();return b})["catch"](function(a){c.env=null;throw a;})}}(),"object"===("undefined"===typeof a?"undefined":g(a)))return a.v}else return f&&(c.dataProcessor.initialize(),c.env=null),Promise.resolve(b)})}},{key:"processVersionSignature",value:function(a){this.progress.notifyStage(b.READ_VERSION,
b.ACTIVE_STATE);return Promise.resolve(a)}},{key:"prepareFlash",value:function(b){this.dataProcessor||("1"===b&&new a,this.dataProcessor=new c(this.dataTransferHandler,this.progress))}},{key:"enqueuedBytes",value:function(){return x.enqueueOnly?null:5E6}},{key:"_flashFileOrUrl",value:function(a,d,c,e){var f=this,g=(new Date).getTime();this.prepareFlash(e);var k=d(this.dataProcessor,this.enqueuedBytes(),c);return Promise.resolve().then(function(){return f.env?f.env:f.readEnvironment()}).then(function(b){f.dataProcessor.setEnvironment(b);
f.dataProcessor.resetByteCounts();f.dataProcessor.reject=null;f.dataProcessor.resolve=null;return k.doFetch(a)})["catch"](function(a){u.info("Error: "+a);return a}).then(function(d){var c=d&&d instanceof Error,e=!d||!(d instanceof Error),k=((new Date).getTime()-g)/1E3,h=100,l=b.DONE;e||(h=f.progress.getCurrentPercent(),l=f.progress.getLastActiveStage());var m=a.substr(a.lastIndexOf("/")+1),k={elapsedTime:k,image:m,nand:f.env.nandChip.id,serial:f.env["serial#"],percent:h,stage:l};c&&(k.cause=d.toString(),
k.stack=JSON.stringify(d.stack));u.track("Flash "+(e?"success":"failure"),k);if(c)throw d;return k})}},{key:"isChipPro",value:function(){return"Toshiba_512M_SLC"===this.nand}},{key:"setDevice",value:function(a){a?"chipPro"===a&&(this.nand="Toshiba_512M_SLC"):this.nand=null}},{key:"flash",value:function(a){var b=a.flashImage;if(b.nfsRoot)return this.nfsBoot(b.nfsBootContext);if(b.url)return this._flashFileOrUrl(b.url,this.factory.createStreamHandler,!1,a.stub);if(b.localFile)return this._flashFileOrUrl(b.localFile,
this.factory.createStreamHandler,!0,a.stub);u.error("shouldn't happen at end of flash"+a)}},{key:"readEnvironment",value:function(){var a=this;if(this.env)return Promise.resolve(this.env);if(this.readingEnvironment)return Promise.resolve(null);if(this.nand){var d=k.makeFakeEnvironment(this.nand);this.progress.notifyData({environment:d});return Promise.resolve(d)}this.readingEnvironment=!0;u.info("reading environment");this.progress.notifyStage(b.READING_DEVICE_INFO,b.ACTIVE_STATE);this.progress.pause();
return this.readUbootVars(!0).timeout(15E3+this.waitForFastbootDriverDelay).then(function(b){a.progress.init();a.progress.notifyProgress();a.progress.notifyData({environment:b});return b})["catch"](function(b){console.log(b);u.info("caught err in uboot env read"+b);var d=b?b.toString():"none",c=b?JSON.stringify(b.stack):"none";u.track("Error reading uboot environment",{cause:d,stack:c});a.env=null;throw b;})["finally"](function(){a.readingEnvironment=!1;a.progress.resume();a.progress.notifyStage(b.WAITING,
b.PASSIVE_STATE)})}},{key:"getEnvironment",value:function(){var a=this;return Promise.resolve().then(function(){return a.env?a.env:a.readEnvironment().then(function(b){a.notifyEnvironment()})})}},{key:"notifyEnvironment",value:function(){return this.env?(this.progress.notifyData({environment:this.env}),!0):!1}},{key:"flashFromCompressedUrl",value:function(a,b){var d=this;u.info("flashFromCompressedUrl");return new Promise(function(c,e){d.prepareFlash(b);var f=d.dataProcessor;f.reject=e;f.streamHandler=
new p(f);return x.fetchUrlIntoArrayBuffer(a,!0).then(f.processChunk.bind(f)).then(f.addMeta.bind(f,c))})}},{key:"spl",value:function(){return this.flashFromCompressedUrl("binary/spl_no_ecc.chp.lzma")}},{key:"writeUboot",value:function(a,b){var d=this.fel();a=a||"binary/u-boot-dtb.bin.lzma";b=b||a.endsWith(".lzma");return x.fetchUrlIntoArrayBuffer(a,b).then(d.writeUboot.bind(d))}},{key:"fel",value:function(a){this.felInstance||(this.felInstance=new t(this.dataTransferHandler));this.dataProcessor&&
this.dataProcessor.setFelInstance(this.felInstance);return this.felInstance}},{key:"ubootEnvironmentString",value:function(a){var b=k.exportEnvironmentString;a&&(b=b.replace("reset","fastboot 0\nreset"));return b}},{key:"sendPendingUbootCommandIfAny",value:function(){var a=this;return this.ubootCommand?(this.doingUbootCommand=!0,this.sendUbootCommand(this.ubootCommand).then(function(){a.ubootCommand=null;a.doingUbootCommand=!1;return!0})):Promise.resolve()}},{key:"sendUbootCommand",value:function(a){var d=
this,c=this.fel();a=k.commandToEnvironment(a);return Promise.resolve().then(function(){d.progress.notifyStage(b.SENDING_UBOOT_COMMAND)}).then(this.spl.bind(this)).then(this.writeUboot.bind(this,"binary/u-boot-dtb.bin.lzma",!0)).then(c.writeUbootScript.bind(c,a)).then(c.exeUboot.bind(c)).then(c.waitForFel.bind(c,this.isWindows))}},{key:"readUbootVars",value:function(a){var c=this,e=this.fel();return this.spl().then(this.writeUboot.bind(this,"binary/u-boot-dtb.bin.lzma",!0)).then(e.writeUbootScript.bind(e,
this.ubootEnvironmentString(a))).then(e.exeUboot.bind(e)).then(function(){return a?(c.progress.notifyStage(b.CHECKING_FASTBOOT_CONNECTIVITY,null,!0),Promise.delay(0).then(function(){return c.dataTransferHandler.waitForFastboot().timeout(15E3+c.waitForFastbootDriverDelay).then(function(){return d.fastbootContinue(c.dataTransferHandler).then(function(a){c.progress.notifyStage(b.READING_DEVICE_INFO,null,!0);return a})})})):Promise.resolve()}).then(e.waitForFel.bind(e,this.isWindows)).then(e.read.bind(e,
k.felEnvScratch,k.felEnvScratchLength)).then(k.parseEnvironment)}},{key:"nfsBoot",value:function(a){var b=this.fel(),d=k.toNfsEnvironment(a.root);this.env.nfsBoot=a.root;this.dataProcessor.resetByteCounts();this.dataProcessor.reject=null;this.dataProcessor.resolve=null;return this.spl().then(this.writeUboot.bind(this,"binary/u-boot-dtb.bin.lzma",!0)).then(x.readUrlOrFile.bind(x,a.kernelUrl,a.kernel)).then(b.writeZImage.bind(b)).then(x.readUrlOrFile.bind(x,a.dtbUrl,a.dtb)).then(b.writeDtb.bind(b)).then(b.writeUbootScript.bind(b,
d)).then(b.exeUboot.bind(b)).then(this.progress.forceComplete.bind(this.progress))}},{key:"cancel",value:function(){this.dataProcessor?(this.dataProcessor.handleError("User Cancel"),u.info("ChromeFlash.cancel(): User has cancelled flash!")):console.log("redundant cancel of flash")}}]);return f}();l.exports=h},function(l,h,f){var g=f(26),m=f(1);l.exports={toImage:function(c,a,e){a=a||"generated";e=e||84018688;if(c instanceof ArrayBuffer){if(654645590===(new DataView(c)).getUint32(0,!1))return c;c=
new Uint8Array(c)}c instanceof Uint8Array&&(c=m.toString(c));"\n"!==c.slice(-1)&&(c+="\n");var d=m.stringToArr(a).slice(0,32),b=c.length;a=new ArrayBuffer(72+b);var f=new Uint8Array(a),h=new DataView(a);h.setUint32(0,654645590,!1);h.setUint32(8,(new Date).getTime(),!1);h.setUint32(8,305419896,!1);h.setUint32(12,b+8,!1);h.setUint32(28,e,!1);f.set(d,32);h.setUint32(64,b,!1);f.set(m.stringToArr(c),72);c=g.buf(Array.from(new Uint8Array(a.slice(64))));h.setUint32(24,c,!1);c=g.buf(Array.from(new Uint8Array(a.slice(0,
64))));h.setUint32(4,c,!1);return a},fromImage:function(c){m.bufferToString(c.slice(64))}}},function(l,h,f){function g(a,c){if("function"!==typeof c&&null!==c)throw new TypeError("Super expression must either be null or a function, not "+typeof c);a.prototype=Object.create(c&&c.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});c&&(Object.setPrototypeOf?Object.setPrototypeOf(a,c):a.__proto__=c)}var m=function(){function a(a,d){for(var b=0;b<d.length;b++){var c=d[b];c.enumerable=
c.enumerable||!1;c.configurable=!0;"value"in c&&(c.writable=!0);Object.defineProperty(a,c.key,c)}}return function(c,d,b){d&&a(c.prototype,d);b&&a(c,b);return c}}();h=f(3);var c=f(0);f(1);f=function(a){function e(a,b){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");var d;d=(e.__proto__||Object.getPrototypeOf(e)).call(this,a,b);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");d=!d||"object"!==typeof d&&"function"!==typeof d?
this:d;d.pausable=!1;return d}g(e,a);m(e,[{key:"doFetch",value:function(a){var b=this,d={mode:"cors",redirect:"follow"};c.info("Doing fetch "+a);return new Promise(function(c,e){return fetch(a,d).then(function(a){b.readableStream=a.body.getReader();return b.read()}).then(function(a){c(a)})["catch"](function(a){console.log("error do fetch");b.dataProcessor.handleError(a);e(a)})})}},{key:"readWithRetries",value:function(){return this.readableStream.read()}},{key:"read",value:function(){var a=this;c.debug("read()");
var b=this;return(new Promise(function(d,e){a.dataProcessor.reject=e;return a.readWithRetries().then(function u(a){return a&&a.done?(c.debug("done"),b.dataProcessor.spark&&c.meta("Hash code is "+b.dataProcessor.calcHash()),b.dataProcessor.addCleanUpMeta(b.startTime),b.dataProcessor.addMeta(d),!0):a&&b.dataProcessor.processChunk(a.value)?b.pausable&&b.paused?null:b.readWithRetries().then(u):(c.error("Aborting on error"),b.readableStream.cancel&&b.readableStream.cancel(),b.dataProcessor.cleanUpPromise().then(function(){c.meta("FAILURE!======== Elapsed time: "+
((new Date).getTime()-b.startTime)/1E3);e(Error("Some error"))}))}.bind(a))}))["catch"](function(a){console.log("caught err and end of read",a);throw a;})}}]);return e}(h);l.exports=f},function(l,h,f){function g(a,c){if("function"!==typeof c&&null!==c)throw new TypeError("Super expression must either be null or a function, not "+typeof c);a.prototype=Object.create(c&&c.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});c&&(Object.setPrototypeOf?Object.setPrototypeOf(a,c):
a.__proto__=c)}var m=function(){function a(a,d){for(var b=0;b<d.length;b++){var c=d[b];c.enumerable=c.enumerable||!1;c.configurable=!0;"value"in c&&(c.writable=!0);Object.defineProperty(a,c.key,c)}}return function(c,d,b){d&&a(c.prototype,d);b&&a(c,b);return c}}();f(0);var c=f(1);h=function(a){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");var a;a=(e.__proto__||Object.getPrototypeOf(e)).call(this);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
a=!a||"object"!==typeof a&&"function"!==typeof a?this:a;console.log("using stub usb");return a}g(e,a);m(e,[{key:"getDevicesPromise",value:function(a,b){return Promise.resolve([1])}},{key:"openChipPromise",value:function(a){return Promise.resolve([1])}},{key:"writePromise",value:function(a,b){return Promise.resolve(b.length).then(function(){50>b.length&&console.log("Write: "+c.arrToString(b));return b.length})}},{key:"closePromise",value:function(a){return Promise.resolve(!0)}},{key:"readPromise",
value:function(a,b){return Promise.resolve(b).then(function(){console.log("Read: "+c.arrToString(b));return b})}}]);return e}(f(6));l.exports=h},function(l,h,f){function g(a){var b=a.length;if(0<b%4)throw Error("Invalid string. Length must be a multiple of 4");return"="===a[b-2]?2:"="===a[b-1]?1:0}function m(a,b,e){for(var d=[],f=b;f<e;f+=3)b=(a[f]<<16)+(a[f+1]<<8)+a[f+2],d.push(c[b>>18&63]+c[b>>12&63]+c[b>>6&63]+c[b&63]);return d.join("")}h.byteLength=function(a){return 3*a.length/4-g(a)};h.toByteArray=
function(c){var b,d,f,h,l;b=c.length;h=g(c);l=new e(3*b/4-h);d=0<h?b-4:b;var m=0;for(b=0;b<d;b+=4)f=a[c.charCodeAt(b)]<<18|a[c.charCodeAt(b+1)]<<12|a[c.charCodeAt(b+2)]<<6|a[c.charCodeAt(b+3)],l[m++]=f>>16&255,l[m++]=f>>8&255,l[m++]=f&255;2===h?(f=a[c.charCodeAt(b)]<<2|a[c.charCodeAt(b+1)]>>4,l[m++]=f&255):1===h&&(f=a[c.charCodeAt(b)]<<10|a[c.charCodeAt(b+1)]<<4|a[c.charCodeAt(b+2)]>>2,l[m++]=f>>8&255,l[m++]=f&255);return l};h.fromByteArray=function(a){for(var b=a.length,d=b%3,e="",f=[],g=0,h=b-d;g<
h;g+=16383)f.push(m(a,g,g+16383>h?h:g+16383));1===d?(a=a[b-1],e+=c[a>>2],e+=c[a<<4&63],e+="=="):2===d&&(a=(a[b-2]<<8)+a[b-1],e+=c[a>>10],e+=c[a>>4&63],e+=c[a<<2&63],e+="=");f.push(e);return f.join("")};var c=[],a=[],e="undefined"!==typeof Uint8Array?Uint8Array:Array;for(l=0;64>l;++l)c[l]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[l],a["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charCodeAt(l)]=l;a[45]=62;a[95]=63},function(l,h,f){(function(g){function l(){try{var a=
new Uint8Array(1);a.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}};return 42===a.foo()&&"function"===typeof a.subarray&&0===a.subarray(1,1).byteLength}catch(r){return!1}}function c(b,c){if((a.TYPED_ARRAY_SUPPORT?2147483647:1073741823)<c)throw new RangeError("Invalid typed array length");a.TYPED_ARRAY_SUPPORT?(b=new Uint8Array(c),b.__proto__=a.prototype):(null===b&&(b=new a(c)),b.length=c);return b}function a(c,d,f){if(!(a.TYPED_ARRAY_SUPPORT||this instanceof a))return new a(c,
d,f);if("number"===typeof c){if("string"===typeof d)throw Error("If encoding is specified then the first argument must be a string");return b(this,c)}return e(this,c,d,f)}function e(b,d,e,f){if("number"===typeof d)throw new TypeError('"value" argument must not be a number');if("undefined"!==typeof ArrayBuffer&&d instanceof ArrayBuffer){d.byteLength;if(0>e||d.byteLength<e)throw new RangeError("'offset' is out of bounds");if(d.byteLength<e+(f||0))throw new RangeError("'length' is out of bounds");d=
void 0===e&&void 0===f?new Uint8Array(d):void 0===f?new Uint8Array(d,e):new Uint8Array(d,e,f);a.TYPED_ARRAY_SUPPORT?(b=d,b.__proto__=a.prototype):b=k(b,d);return b}if("string"===typeof d){f=b;b=e;if("string"!==typeof b||""===b)b="utf8";if(!a.isEncoding(b))throw new TypeError('"encoding" must be a valid string encoding');e=u(d,b)|0;f=c(f,e);d=f.write(d,b);d!==e&&(f=f.slice(0,d));return f}return p(b,d)}function d(a){if("number"!==typeof a)throw new TypeError('"size" argument must be a number');if(0>
a)throw new RangeError('"size" argument must not be negative');}function b(b,r){d(r);b=c(b,0>r?0:t(r)|0);if(!a.TYPED_ARRAY_SUPPORT)for(var n=0;n<r;++n)b[n]=0;return b}function k(a,b){var d=0>b.length?0:t(b.length)|0;a=c(a,d);for(var n=0;n<d;n+=1)a[n]=b[n]&255;return a}function p(b,d){if(a.isBuffer(d)){var n=t(d.length)|0;b=c(b,n);if(0===b.length)return b;d.copy(b,0,0,n);return b}if(d){if("undefined"!==typeof ArrayBuffer&&d.buffer instanceof ArrayBuffer||"length"in d)return(n="number"!==typeof d.length)||
(n=d.length,n=n!==n),n?c(b,0):k(b,d);if("Buffer"===d.type&&M(d.data))return k(b,d.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.");}function t(b){if(b>=(a.TYPED_ARRAY_SUPPORT?2147483647:1073741823))throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+(a.TYPED_ARRAY_SUPPORT?2147483647:1073741823).toString(16)+" bytes");return b|0}function u(b,c){if(a.isBuffer(b))return b.length;if("undefined"!==typeof ArrayBuffer&&
"function"===typeof ArrayBuffer.isView&&(ArrayBuffer.isView(b)||b instanceof ArrayBuffer))return b.byteLength;"string"!==typeof b&&(b=""+b);var d=b.length;if(0===d)return 0;for(var n=!1;;)switch(c){case "ascii":case "latin1":case "binary":return d;case "utf8":case "utf-8":case void 0:return J(b).length;case "ucs2":case "ucs-2":case "utf16le":case "utf-16le":return 2*d;case "hex":return d>>>1;case "base64":return L.toByteArray(K(b)).length;default:if(n)return J(b).length;c=(""+c).toLowerCase();n=!0}}
function x(a,b,c){var d=!1;if(void 0===b||0>b)b=0;if(b>this.length)return"";if(void 0===c||c>this.length)c=this.length;if(0>=c)return"";c>>>=0;b>>>=0;if(c<=b)return"";for(a||(a="utf8");;)switch(a){case "hex":a=b;b=c;c=this.length;if(!a||0>a)a=0;if(!b||0>b||b>c)b=c;d="";for(c=a;c<b;++c)a=d,d=this[c],d=16>d?"0"+d.toString(16):d.toString(16),d=a+d;return d;case "utf8":case "utf-8":return y(this,b,c);case "ascii":a="";for(c=Math.min(this.length,c);b<c;++b)a+=String.fromCharCode(this[b]&127);return a;
case "latin1":case "binary":a="";for(c=Math.min(this.length,c);b<c;++b)a+=String.fromCharCode(this[b]);return a;case "base64":return b=0===b&&c===this.length?L.fromByteArray(this):L.fromByteArray(this.slice(b,c)),b;case "ucs2":case "ucs-2":case "utf16le":case "utf-16le":b=this.slice(b,c);c="";for(a=0;a<b.length;a+=2)c+=String.fromCharCode(b[a]+256*b[a+1]);return c;default:if(d)throw new TypeError("Unknown encoding: "+a);a=(a+"").toLowerCase();d=!0}}function w(a,b,c){var d=a[b];a[b]=a[c];a[c]=d}function C(b,
c,d,e,f){if(0===b.length)return-1;"string"===typeof d?(e=d,d=0):2147483647<d?d=2147483647:-2147483648>d&&(d=-2147483648);d=+d;isNaN(d)&&(d=f?0:b.length-1);0>d&&(d=b.length+d);if(d>=b.length){if(f)return-1;d=b.length-1}else if(0>d)if(f)d=0;else return-1;"string"===typeof c&&(c=a.from(c,e));if(a.isBuffer(c))return 0===c.length?-1:z(b,c,d,e,f);if("number"===typeof c)return c&=255,a.TYPED_ARRAY_SUPPORT&&"function"===typeof Uint8Array.prototype.indexOf?f?Uint8Array.prototype.indexOf.call(b,c,d):Uint8Array.prototype.lastIndexOf.call(b,
c,d):z(b,[c],d,e,f);throw new TypeError("val must be string, number or Buffer");}function z(a,b,c,d,e){function n(a,b){return 1===f?a[b]:a.readUInt16BE(b*f)}var f=1,r=a.length,g=b.length;if(void 0!==d&&(d=String(d).toLowerCase(),"ucs2"===d||"ucs-2"===d||"utf16le"===d||"utf-16le"===d)){if(2>a.length||2>b.length)return-1;f=2;r/=2;g/=2;c/=2}if(e)for(d=-1;c<r;c++)if(n(a,c)===n(b,-1===d?0:c-d)){if(-1===d&&(d=c),c-d+1===g)return d*f}else-1!==d&&(c-=c-d),d=-1;else for(c+g>r&&(c=r-g);0<=c;c--){r=!0;for(d=
0;d<g;d++)if(n(a,c+d)!==n(b,d)){r=!1;break}if(r)return c}return-1}function y(a,b,c){c=Math.min(a.length,c);for(var d=[];b<c;){var n=a[b],e=null,f=239<n?4:223<n?3:191<n?2:1;if(b+f<=c){var r,g,H;switch(f){case 1:128>n&&(e=n);break;case 2:r=a[b+1];128===(r&192)&&(n=(n&31)<<6|r&63,127<n&&(e=n));break;case 3:r=a[b+1];g=a[b+2];128===(r&192)&&128===(g&192)&&(n=(n&15)<<12|(r&63)<<6|g&63,2047<n&&(55296>n||57343<n)&&(e=n));break;case 4:r=a[b+1],g=a[b+2],H=a[b+3],128===(r&192)&&128===(g&192)&&128===(H&192)&&
(n=(n&15)<<18|(r&63)<<12|(g&63)<<6|H&63,65535<n&&1114112>n&&(e=n))}}null===e?(e=65533,f=1):65535<e&&(e-=65536,d.push(e>>>10&1023|55296),e=56320|e&1023);d.push(e);b+=f}a=d.length;if(a<=O)d=String.fromCharCode.apply(String,d);else{c="";for(b=0;b<a;)c+=String.fromCharCode.apply(String,d.slice(b,b+=O));d=c}return d}function q(a,b,c){if(0!==a%1||0>a)throw new RangeError("offset is not uint");if(a+b>c)throw new RangeError("Trying to access beyond buffer length");}function v(b,c,d,e,f,g){if(!a.isBuffer(b))throw new TypeError('"buffer" argument must be a Buffer instance');
if(c>f||c<g)throw new RangeError('"value" argument is out of bounds');if(d+e>b.length)throw new RangeError("Index out of range");}function A(a,b,c,d){0>b&&(b=65535+b+1);for(var n=0,e=Math.min(a.length-c,2);n<e;++n)a[c+n]=(b&255<<8*(d?n:1-n))>>>8*(d?n:1-n)}function B(a,b,c,d){0>b&&(b=4294967295+b+1);for(var n=0,e=Math.min(a.length-c,4);n<e;++n)a[c+n]=b>>>8*(d?n:3-n)&255}function E(a,b,c,d,e,f){if(c+d>a.length)throw new RangeError("Index out of range");if(0>c)throw new RangeError("Index out of range");
}function D(a,b,c,d,e){e||E(a,b,c,4,3.4028234663852886E38,-3.4028234663852886E38);I.write(a,b,c,d,23,4);return c+4}function F(a,b,c,d,e){e||E(a,b,c,8,1.7976931348623157E308,-1.7976931348623157E308);I.write(a,b,c,d,52,8);return c+8}function K(a){a=a.trim?a.trim():a.replace(/^\s+|\s+$/g,"");a=a.replace(P,"");if(2>a.length)return"";for(;0!==a.length%4;)a+="=";return a}function J(a,b){b=b||Infinity;for(var c,d=a.length,e=null,n=[],f=0;f<d;++f){c=a.charCodeAt(f);if(55295<c&&57344>c){if(!e){if(56319<c){-1<
(b-=3)&&n.push(239,191,189);continue}else if(f+1===d){-1<(b-=3)&&n.push(239,191,189);continue}e=c;continue}if(56320>c){-1<(b-=3)&&n.push(239,191,189);e=c;continue}c=(e-55296<<10|c-56320)+65536}else e&&-1<(b-=3)&&n.push(239,191,189);e=null;if(128>c){if(0>--b)break;n.push(c)}else if(2048>c){if(0>(b-=2))break;n.push(c>>6|192,c&63|128)}else if(65536>c){if(0>(b-=3))break;n.push(c>>12|224,c>>6&63|128,c&63|128)}else if(1114112>c){if(0>(b-=4))break;n.push(c>>18|240,c>>12&63|128,c>>6&63|128,c&63|128)}else throw Error("Invalid code point");
}return n}function N(a){for(var b=[],c=0;c<a.length;++c)b.push(a.charCodeAt(c)&255);return b}function G(a,b,c,d){for(var e=0;e<d&&!(e+c>=b.length||e>=a.length);++e)b[e+c]=a[e];return e}var L=f(24),I=f(27),M=f(28);h.Buffer=a;h.SlowBuffer=function(b){+b!=b&&(b=0);return a.alloc(+b)};h.INSPECT_MAX_BYTES=50;a.TYPED_ARRAY_SUPPORT=void 0!==g.TYPED_ARRAY_SUPPORT?g.TYPED_ARRAY_SUPPORT:l();h.kMaxLength=a.TYPED_ARRAY_SUPPORT?2147483647:1073741823;a.poolSize=8192;a._augment=function(b){b.__proto__=a.prototype;
return b};a.from=function(a,b,c){return e(null,a,b,c)};a.TYPED_ARRAY_SUPPORT&&(a.prototype.__proto__=Uint8Array.prototype,a.__proto__=Uint8Array,"undefined"!==typeof Symbol&&Symbol.species&&a[Symbol.species]===a&&Object.defineProperty(a,Symbol.species,{value:null,configurable:!0}));a.alloc=function(a,b,e){d(a);a=0>=a?c(null,a):void 0!==b?"string"===typeof e?c(null,a).fill(b,e):c(null,a).fill(b):c(null,a);return a};a.allocUnsafe=function(a){return b(null,a)};a.allocUnsafeSlow=function(a){return b(null,
a)};a.isBuffer=function(a){return!(null==a||!a._isBuffer)};a.compare=function(b,c){if(!a.isBuffer(b)||!a.isBuffer(c))throw new TypeError("Arguments must be Buffers");if(b===c)return 0;for(var d=b.length,e=c.length,f=0,n=Math.min(d,e);f<n;++f)if(b[f]!==c[f]){d=b[f];e=c[f];break}return d<e?-1:e<d?1:0};a.isEncoding=function(a){switch(String(a).toLowerCase()){case "hex":case "utf8":case "utf-8":case "ascii":case "latin1":case "binary":case "base64":case "ucs2":case "ucs-2":case "utf16le":case "utf-16le":return!0;
default:return!1}};a.concat=function(b,c){if(!M(b))throw new TypeError('"list" argument must be an Array of Buffers');if(0===b.length)return a.alloc(0);var d;if(void 0===c)for(d=c=0;d<b.length;++d)c+=b[d].length;var e=a.allocUnsafe(c),f=0;for(d=0;d<b.length;++d){var n=b[d];if(!a.isBuffer(n))throw new TypeError('"list" argument must be an Array of Buffers');n.copy(e,f);f+=n.length}return e};a.byteLength=u;a.prototype._isBuffer=!0;a.prototype.swap16=function(){var a=this.length;if(0!==a%2)throw new RangeError("Buffer size must be a multiple of 16-bits");
for(var b=0;b<a;b+=2)w(this,b,b+1);return this};a.prototype.swap32=function(){var a=this.length;if(0!==a%4)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var b=0;b<a;b+=4)w(this,b,b+3),w(this,b+1,b+2);return this};a.prototype.swap64=function(){var a=this.length;if(0!==a%8)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var b=0;b<a;b+=8)w(this,b,b+7),w(this,b+1,b+6),w(this,b+2,b+5),w(this,b+3,b+4);return this};a.prototype.toString=function(){var a=this.length|
0;return 0===a?"":0===arguments.length?y(this,0,a):x.apply(this,arguments)};a.prototype.equals=function(b){if(!a.isBuffer(b))throw new TypeError("Argument must be a Buffer");return this===b?!0:0===a.compare(this,b)};a.prototype.inspect=function(){var a="",b=h.INSPECT_MAX_BYTES;0<this.length&&(a=this.toString("hex",0,b).match(/.{2}/g).join(" "),this.length>b&&(a+=" ... "));return"<Buffer "+a+">"};a.prototype.compare=function(b,c,d,e,f){if(!a.isBuffer(b))throw new TypeError("Argument must be a Buffer");
void 0===c&&(c=0);void 0===d&&(d=b?b.length:0);void 0===e&&(e=0);void 0===f&&(f=this.length);if(0>c||d>b.length||0>e||f>this.length)throw new RangeError("out of range index");if(e>=f&&c>=d)return 0;if(e>=f)return-1;if(c>=d)return 1;c>>>=0;d>>>=0;e>>>=0;f>>>=0;if(this===b)return 0;var n=f-e,g=d-c,r=Math.min(n,g);e=this.slice(e,f);b=b.slice(c,d);for(c=0;c<r;++c)if(e[c]!==b[c]){n=e[c];g=b[c];break}return n<g?-1:g<n?1:0};a.prototype.includes=function(a,b,c){return-1!==this.indexOf(a,b,c)};a.prototype.indexOf=
function(a,b,c){return C(this,a,b,c,!0)};a.prototype.lastIndexOf=function(a,b,c){return C(this,a,b,c,!1)};a.prototype.write=function(a,b,c,d){if(void 0===b)d="utf8",c=this.length,b=0;else if(void 0===c&&"string"===typeof b)d=b,c=this.length,b=0;else if(isFinite(b))b|=0,isFinite(c)?(c|=0,void 0===d&&(d="utf8")):(d=c,c=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var e=this.length-b;if(void 0===c||c>e)c=e;if(0<a.length&&(0>c||0>b)||b>this.length)throw new RangeError("Attempt to write outside buffer bounds");
d||(d="utf8");for(e=!1;;)switch(d){case "hex":a:{b=Number(b)||0;d=this.length-b;c?(c=Number(c),c>d&&(c=d)):c=d;d=a.length;if(0!==d%2)throw new TypeError("Invalid hex string");c>d/2&&(c=d/2);for(d=0;d<c;++d){e=parseInt(a.substr(2*d,2),16);if(isNaN(e)){a=d;break a}this[b+d]=e}a=d}return a;case "utf8":case "utf-8":return G(J(a,this.length-b),this,b,c);case "ascii":return G(N(a),this,b,c);case "latin1":case "binary":return G(N(a),this,b,c);case "base64":return G(L.toByteArray(K(a)),this,b,c);case "ucs2":case "ucs-2":case "utf16le":case "utf-16le":d=
this.length-b;for(var f,g=[],n=0;n<a.length&&!(0>(d-=2));++n)f=a.charCodeAt(n),e=f>>8,f%=256,g.push(f),g.push(e);return G(g,this,b,c);default:if(e)throw new TypeError("Unknown encoding: "+d);d=(""+d).toLowerCase();e=!0}};a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var O=4096;a.prototype.slice=function(b,c){var d=this.length;b=~~b;c=void 0===c?d:~~c;0>b?(b+=d,0>b&&(b=0)):b>d&&(b=d);0>c?(c+=d,0>c&&(c=0)):c>d&&(c=d);c<b&&(c=b);if(a.TYPED_ARRAY_SUPPORT)d=
this.subarray(b,c),d.__proto__=a.prototype;else for(var e=c-b,d=new a(e,void 0),f=0;f<e;++f)d[f]=this[f+b];return d};a.prototype.readUIntLE=function(a,b,c){a|=0;b|=0;c||q(a,b,this.length);c=this[a];for(var d=1,e=0;++e<b&&(d*=256);)c+=this[a+e]*d;return c};a.prototype.readUIntBE=function(a,b,c){a|=0;b|=0;c||q(a,b,this.length);c=this[a+--b];for(var d=1;0<b&&(d*=256);)c+=this[a+--b]*d;return c};a.prototype.readUInt8=function(a,b){b||q(a,1,this.length);return this[a]};a.prototype.readUInt16LE=function(a,
b){b||q(a,2,this.length);return this[a]|this[a+1]<<8};a.prototype.readUInt16BE=function(a,b){b||q(a,2,this.length);return this[a]<<8|this[a+1]};a.prototype.readUInt32LE=function(a,b){b||q(a,4,this.length);return(this[a]|this[a+1]<<8|this[a+2]<<16)+16777216*this[a+3]};a.prototype.readUInt32BE=function(a,b){b||q(a,4,this.length);return 16777216*this[a]+(this[a+1]<<16|this[a+2]<<8|this[a+3])};a.prototype.readIntLE=function(a,b,c){a|=0;b|=0;c||q(a,b,this.length);c=this[a];for(var d=1,e=0;++e<b&&(d*=256);)c+=
this[a+e]*d;c>=128*d&&(c-=Math.pow(2,8*b));return c};a.prototype.readIntBE=function(a,b,c){a|=0;b|=0;c||q(a,b,this.length);c=b;for(var d=1,e=this[a+--c];0<c&&(d*=256);)e+=this[a+--c]*d;e>=128*d&&(e-=Math.pow(2,8*b));return e};a.prototype.readInt8=function(a,b){b||q(a,1,this.length);return this[a]&128?-1*(255-this[a]+1):this[a]};a.prototype.readInt16LE=function(a,b){b||q(a,2,this.length);var c=this[a]|this[a+1]<<8;return c&32768?c|4294901760:c};a.prototype.readInt16BE=function(a,b){b||q(a,2,this.length);
var c=this[a+1]|this[a]<<8;return c&32768?c|4294901760:c};a.prototype.readInt32LE=function(a,b){b||q(a,4,this.length);return this[a]|this[a+1]<<8|this[a+2]<<16|this[a+3]<<24};a.prototype.readInt32BE=function(a,b){b||q(a,4,this.length);return this[a]<<24|this[a+1]<<16|this[a+2]<<8|this[a+3]};a.prototype.readFloatLE=function(a,b){b||q(a,4,this.length);return I.read(this,a,!0,23,4)};a.prototype.readFloatBE=function(a,b){b||q(a,4,this.length);return I.read(this,a,!1,23,4)};a.prototype.readDoubleLE=function(a,
b){b||q(a,8,this.length);return I.read(this,a,!0,52,8)};a.prototype.readDoubleBE=function(a,b){b||q(a,8,this.length);return I.read(this,a,!1,52,8)};a.prototype.writeUIntLE=function(a,b,c,d){a=+a;b|=0;c|=0;d||v(this,a,b,c,Math.pow(2,8*c)-1,0);d=1;var e=0;for(this[b]=a&255;++e<c&&(d*=256);)this[b+e]=a/d&255;return b+c};a.prototype.writeUIntBE=function(a,b,c,d){a=+a;b|=0;c|=0;d||v(this,a,b,c,Math.pow(2,8*c)-1,0);d=c-1;var e=1;for(this[b+d]=a&255;0<=--d&&(e*=256);)this[b+d]=a/e&255;return b+c};a.prototype.writeUInt8=
function(b,c,d){b=+b;c|=0;d||v(this,b,c,1,255,0);a.TYPED_ARRAY_SUPPORT||(b=Math.floor(b));this[c]=b&255;return c+1};a.prototype.writeUInt16LE=function(b,c,d){b=+b;c|=0;d||v(this,b,c,2,65535,0);a.TYPED_ARRAY_SUPPORT?(this[c]=b&255,this[c+1]=b>>>8):A(this,b,c,!0);return c+2};a.prototype.writeUInt16BE=function(b,c,d){b=+b;c|=0;d||v(this,b,c,2,65535,0);a.TYPED_ARRAY_SUPPORT?(this[c]=b>>>8,this[c+1]=b&255):A(this,b,c,!1);return c+2};a.prototype.writeUInt32LE=function(b,c,d){b=+b;c|=0;d||v(this,b,c,4,4294967295,
0);a.TYPED_ARRAY_SUPPORT?(this[c+3]=b>>>24,this[c+2]=b>>>16,this[c+1]=b>>>8,this[c]=b&255):B(this,b,c,!0);return c+4};a.prototype.writeUInt32BE=function(b,c,d){b=+b;c|=0;d||v(this,b,c,4,4294967295,0);a.TYPED_ARRAY_SUPPORT?(this[c]=b>>>24,this[c+1]=b>>>16,this[c+2]=b>>>8,this[c+3]=b&255):B(this,b,c,!1);return c+4};a.prototype.writeIntLE=function(a,b,c,d){a=+a;b|=0;d||(d=Math.pow(2,8*c-1),v(this,a,b,c,d-1,-d));d=0;var e=1,f=0;for(this[b]=a&255;++d<c&&(e*=256);)0>a&&0===f&&0!==this[b+d-1]&&(f=1),this[b+
d]=(a/e>>0)-f&255;return b+c};a.prototype.writeIntBE=function(a,b,c,d){a=+a;b|=0;d||(d=Math.pow(2,8*c-1),v(this,a,b,c,d-1,-d));d=c-1;var e=1,f=0;for(this[b+d]=a&255;0<=--d&&(e*=256);)0>a&&0===f&&0!==this[b+d+1]&&(f=1),this[b+d]=(a/e>>0)-f&255;return b+c};a.prototype.writeInt8=function(b,c,d){b=+b;c|=0;d||v(this,b,c,1,127,-128);a.TYPED_ARRAY_SUPPORT||(b=Math.floor(b));0>b&&(b=255+b+1);this[c]=b&255;return c+1};a.prototype.writeInt16LE=function(b,c,d){b=+b;c|=0;d||v(this,b,c,2,32767,-32768);a.TYPED_ARRAY_SUPPORT?
(this[c]=b&255,this[c+1]=b>>>8):A(this,b,c,!0);return c+2};a.prototype.writeInt16BE=function(b,c,d){b=+b;c|=0;d||v(this,b,c,2,32767,-32768);a.TYPED_ARRAY_SUPPORT?(this[c]=b>>>8,this[c+1]=b&255):A(this,b,c,!1);return c+2};a.prototype.writeInt32LE=function(b,c,d){b=+b;c|=0;d||v(this,b,c,4,2147483647,-2147483648);a.TYPED_ARRAY_SUPPORT?(this[c]=b&255,this[c+1]=b>>>8,this[c+2]=b>>>16,this[c+3]=b>>>24):B(this,b,c,!0);return c+4};a.prototype.writeInt32BE=function(b,c,d){b=+b;c|=0;d||v(this,b,c,4,2147483647,
-2147483648);0>b&&(b=4294967295+b+1);a.TYPED_ARRAY_SUPPORT?(this[c]=b>>>24,this[c+1]=b>>>16,this[c+2]=b>>>8,this[c+3]=b&255):B(this,b,c,!1);return c+4};a.prototype.writeFloatLE=function(a,b,c){return D(this,a,b,!0,c)};a.prototype.writeFloatBE=function(a,b,c){return D(this,a,b,!1,c)};a.prototype.writeDoubleLE=function(a,b,c){return F(this,a,b,!0,c)};a.prototype.writeDoubleBE=function(a,b,c){return F(this,a,b,!1,c)};a.prototype.copy=function(b,c,d,e){d||(d=0);e||0===e||(e=this.length);c>=b.length&&
(c=b.length);c||(c=0);0<e&&e<d&&(e=d);if(e===d||0===b.length||0===this.length)return 0;if(0>c)throw new RangeError("targetStart out of bounds");if(0>d||d>=this.length)throw new RangeError("sourceStart out of bounds");if(0>e)throw new RangeError("sourceEnd out of bounds");e>this.length&&(e=this.length);b.length-c<e-d&&(e=b.length-c+d);var f=e-d;if(this===b&&d<c&&c<e)for(e=f-1;0<=e;--e)b[e+c]=this[e+d];else if(1E3>f||!a.TYPED_ARRAY_SUPPORT)for(e=0;e<f;++e)b[e+c]=this[e+d];else Uint8Array.prototype.set.call(b,
this.subarray(d,d+f),c);return f};a.prototype.fill=function(b,c,d,e){if("string"===typeof b){"string"===typeof c?(e=c,c=0,d=this.length):"string"===typeof d&&(e=d,d=this.length);if(1===b.length){var f=b.charCodeAt(0);256>f&&(b=f)}if(void 0!==e&&"string"!==typeof e)throw new TypeError("encoding must be a string");if("string"===typeof e&&!a.isEncoding(e))throw new TypeError("Unknown encoding: "+e);}else"number"===typeof b&&(b&=255);if(0>c||this.length<c||this.length<d)throw new RangeError("Out of range index");
if(d<=c)return this;c>>>=0;d=void 0===d?this.length:d>>>0;b||(b=0);if("number"===typeof b)for(e=c;e<d;++e)this[e]=b;else for(b=a.isBuffer(b)?b:J((new a(b,e)).toString()),f=b.length,e=0;e<d-c;++e)this[e+c]=b[e%f];return this};var P=/[^+\/0-9A-Za-z-_]/g}).call(h,f(29))},function(l,h,f){(function(f){(function(f){"undefined"===typeof DO_NOT_EXPORT_CRC?f(h):f({})})(function(g){function c(c){for(var b=-1,d=c.length-7,e=0;e<d;)b=b>>>8^a[(b^c[e++])&255],b=b>>>8^a[(b^c[e++])&255],b=b>>>8^a[(b^c[e++])&255],
b=b>>>8^a[(b^c[e++])&255],b=b>>>8^a[(b^c[e++])&255],b=b>>>8^a[(b^c[e++])&255],b=b>>>8^a[(b^c[e++])&255],b=b>>>8^a[(b^c[e++])&255];for(;e<d+7;)b=b>>>8^a[(b^c[e++])&255];return b^-1}g.version="0.4.1";var a=function(){for(var a,b=Array(256),c=0;256!=c;++c)a=c,a=a&1?-306674912^a>>>1:a>>>1,a=a&1?-306674912^a>>>1:a>>>1,a=a&1?-306674912^a>>>1:a>>>1,a=a&1?-306674912^a>>>1:a>>>1,a=a&1?-306674912^a>>>1:a>>>1,a=a&1?-306674912^a>>>1:a>>>1,a=a&1?-306674912^a>>>1:a>>>1,a=a&1?-306674912^a>>>1:a>>>1,b[c]=a;return"undefined"!==
typeof Int32Array?new Int32Array(b):b}(),e="undefined"!==typeof f;g.table=a;g.bstr=function(d){if(32768<d.length&&e)return c(new f(d));for(var b=-1,g=d.length-1,h=0;h<g;)b=b>>>8^a[(b^d.charCodeAt(h++))&255],b=b>>>8^a[(b^d.charCodeAt(h++))&255];h===g&&(b=b>>>8^a[(b^d.charCodeAt(h))&255]);return b^-1};g.buf=function(d){if(1E4<d.length)return c(d);for(var b=-1,e=d.length-3,f=0;f<e;)b=b>>>8^a[(b^d[f++])&255],b=b>>>8^a[(b^d[f++])&255],b=b>>>8^a[(b^d[f++])&255],b=b>>>8^a[(b^d[f++])&255];for(;f<e+3;)b=b>>>
8^a[(b^d[f++])&255];return b^-1};g.str=function(c){for(var b=-1,d=0,e=c.length,f,g;d<e;)f=c.charCodeAt(d++),128>f?b=b>>>8^a[(b^f)&255]:2048>f?(b=b>>>8^a[(b^(192|f>>6&31))&255],b=b>>>8^a[(b^(128|f&63))&255]):55296<=f&&57344>f?(f=(f&1023)+64,g=c.charCodeAt(d++)&1023,b=b>>>8^a[(b^(240|f>>8&7))&255],b=b>>>8^a[(b^(128|f>>2&63))&255],b=b>>>8^a[(b^(128|g>>6&15|(f&3)<<4))&255],b=b>>>8^a[(b^(128|g&63))&255]):(b=b>>>8^a[(b^(224|f>>12&15))&255],b=b>>>8^a[(b^(128|f>>6&63))&255],b=b>>>8^a[(b^(128|f&63))&255]);
return b^-1}})}).call(h,f(25).Buffer)},function(l,h){h.read=function(f,g,h,c,a){var e;e=8*a-c-1;var d=(1<<e)-1,b=d>>1,k=-7;a=h?a-1:0;var l=h?-1:1,m=f[g+a];a+=l;h=m&(1<<-k)-1;m>>=-k;for(k+=e;0<k;h=256*h+f[g+a],a+=l,k-=8);e=h&(1<<-k)-1;h>>=-k;for(k+=c;0<k;e=256*e+f[g+a],a+=l,k-=8);if(0===h)h=1-b;else{if(h===d)return e?NaN:Infinity*(m?-1:1);e+=Math.pow(2,c);h-=b}return(m?-1:1)*e*Math.pow(2,h-c)};h.write=function(f,g,h,c,a,e){var d,b=8*e-a-1,k=(1<<b)-1,l=k>>1,m=23===a?Math.pow(2,-24)-Math.pow(2,-77):
0;e=c?0:e-1;var u=c?1:-1,x=0>g||0===g&&0>1/g?1:0;g=Math.abs(g);isNaN(g)||Infinity===g?(g=isNaN(g)?1:0,c=k):(c=Math.floor(Math.log(g)/Math.LN2),1>g*(d=Math.pow(2,-c))&&(c--,d*=2),g=1<=c+l?g+m/d:g+m*Math.pow(2,1-l),2<=g*d&&(c++,d/=2),c+l>=k?(g=0,c=k):1<=c+l?(g=(g*d-1)*Math.pow(2,a),c+=l):(g=g*Math.pow(2,l-1)*Math.pow(2,a),c=0));for(;8<=a;f[h+e]=g&255,e+=u,g/=256,a-=8);c=c<<a|g;for(b+=a;0<b;f[h+e]=c&255,e+=u,c/=256,b-=8);f[h+e-u]|=128*x}},function(l,h){var f={}.toString;l.exports=Array.isArray||function(g){return"[object Array]"==
f.call(g)}},function(l,h){var f;f=function(){return this}();try{f=f||Function("return this")()||(0,eval)("this")}catch(g){"object"===typeof window&&(f=window)}l.exports=f},function(l,h,f){l.exports=f(10)}]);
